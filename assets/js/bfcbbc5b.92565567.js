"use strict";(self.webpackChunk_bimo_docs_website=self.webpackChunk_bimo_docs_website||[]).push([[7680],{579:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var s=i(2540),n=i(3023);const r={sidebar_position:10,hide_blog_post_date:!1},o="Charger des donn\xe9es depuis HASTUS",l={id:"getting-started/load-data/from-hastus",title:"Charger des donn\xe9es depuis HASTUS",description:"Le package @bimo/core-utils-control-file-and-csv-data-parser permet de:",source:"@site/docs/getting-started/load-data/from-hastus.mdx",sourceDirName:"getting-started/load-data",slug:"/getting-started/load-data/from-hastus",permalink:"/docs/getting-started/load-data/from-hastus",draft:!1,unlisted:!1,editUrl:"https://github.com/bimodata/bimo/tree/develop/docs-website/docs/getting-started/load-data/from-hastus.mdx",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,hide_blog_post_date:!1},sidebar:"tutorialSidebar",previous:{title:"Charger des donn\xe9es",permalink:"/docs/getting-started/load-data/"},next:{title:"Charger des donn\xe9es JSON",permalink:"/docs/getting-started/load-data/from-json"}},a={},c=[{value:"G\xe9n\xe9ralit\xe9s",id:"g\xe9n\xe9ralit\xe9s",level:2},{value:"Types d&#39;entit\xe9s &quot;chargeables&quot;",id:"types-dentit\xe9s-chargeables",level:3},{value:"Compatibilit\xe9 avec votre version HASTUS",id:"compatibilit\xe9-avec-votre-version-hastus",level:3},{value:"Compatibilit\xe9 avec vos attributs sp\xe9cifiques",id:"compatibilit\xe9-avec-vos-attributs-sp\xe9cifiques",level:3},{value:"Charger des donn\xe9es disponibles dans un r\xe9pertoire local",id:"charger-des-donn\xe9es-disponibles-dans-un-r\xe9pertoire-local",level:2},{value:"Exemple",id:"exemple",level:3},{value:"Options",id:"options",level:3},{value:"Charger des donn\xe9es dans une architecture plus complexe",id:"charger-des-donn\xe9es-dans-une-architecture-plus-complexe",level:2},{value:"Exemple",id:"exemple-1",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"charger-des-donn\xe9es-depuis-hastus",children:"Charger des donn\xe9es depuis HASTUS"}),"\n",(0,s.jsxs)(t.p,{children:["Le package ",(0,s.jsx)(t.a,{href:"https://github.com/bimodata/bimo/tree/main/public/core/utils/control-file-and-csv-data-parser",children:(0,s.jsx)(t.code,{children:"@bimo/core-utils-control-file-and-csv-data-parser"})})," permet de:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"analyser un fichier de contr\xf4le (par exemple, un fichier .oir HASTUS) qui d\xe9crit un format de donn\xe9es"}),"\n",(0,s.jsx)(t.li,{children:"analyser un fichier de donn\xe9es en interpr\xe9tant son contenu \xe0 la lumi\xe8re des informations pr\xe9alablement obtenues en analysant le fichier de contr\xf4le"}),"\n",(0,s.jsx)(t.li,{children:"renvoyer les donn\xe9es sous forme d'objets JavaScript structur\xe9s"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Plusieurs packages ont \xe9t\xe9 cr\xe9\xe9s pour enrober ce package et en simplifier l'utilisation en fonction des cas d'usage."}),"\n",(0,s.jsx)(t.h2,{id:"g\xe9n\xe9ralit\xe9s",children:"G\xe9n\xe9ralit\xe9s"}),"\n",(0,s.jsx)(t.h3,{id:"types-dentit\xe9s-chargeables",children:'Types d\'entit\xe9s "chargeables"'}),"\n",(0,s.jsx)(t.p,{children:"Comme vous le verrez dans les exemples, pour toutes les m\xe9thodes, il faut passer en argument le constructeur du type d'entit\xe9 que l'on souhaite charger. \xc0 ce jour, les types d'entit\xe9s \"chargeables\" sont:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"PlacesCollection"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"VehicleSchedulesCollection"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"RouteVersionsCollection"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"RunTimeVersionsCollection"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"BookingsCollection"})}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"compatibilit\xe9-avec-votre-version-hastus",children:"Compatibilit\xe9 avec votre version HASTUS"}),"\n",(0,s.jsx)(t.p,{children:"Bimo a pour le moment \xe9t\xe9 utilis\xe9 uniquement avec HASTUS 2019 et 2020 (et un tout petit peu 2014). Les entit\xe9s Bimo sont construites sur la base des objets HASTUS disponibles dans ces versions. Les principaux objets HASTUS n'\xe9voluent pas \xe9norm\xe9ment - vous ne devriez donc pas avoir de probl\xe8me \xe0 utiliser Bimo avec d'autres versions d'HASTUS (mais n'h\xe9sitez pas \xe0 nous contacter en cas de probl\xe8me)."}),"\n",(0,s.jsx)(t.h3,{id:"compatibilit\xe9-avec-vos-attributs-sp\xe9cifiques",children:"Compatibilit\xe9 avec vos attributs sp\xe9cifiques"}),"\n",(0,s.jsx)(t.p,{children:"Si vous avez ajout\xe9 des attributs sp\xe9cifiques sur des objets dans votre version d'HASTUS, vous avez probablement envie de pouvoir manipuler ces attributs dans Bimo !"}),"\n",(0,s.jsx)(t.p,{children:"Il y a deux m\xe9thodes pour y arriver:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["La m\xe9thode compliqu\xe9e: cr\xe9er vos propres entit\xe9s dans Bimo en \xe9tendant les entit\xe9s Bimo de base","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Cette m\xe9thode n'est pas document\xe9e pour le moment"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.li,{children:'La m\xe9thode simple: utiliser "_rawOirProps"'}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Quand vous chargez les entit\xe9s \xe0 partir d'un fichier de donn\xe9es et d'un fichier de contr\xf4le extraits d'HASTUS, les valeurs brutes de tous les attributs d\xe9crits dans les fichiers sont stock\xe9es dans l'attributs ",(0,s.jsx)(t.code,{children:"_rawOirProps"})," sur chaque entit\xe9 charg\xe9e. Ces valeurs seront \xe9galement r\xe9export\xe9es vers des fichiers \xe0 la fin de votre traitement si le fichier de contr\xf4le utilis\xe9 pour l'export d\xe9crit un attribut ayant le m\xeame nom."]}),"\n",(0,s.jsx)(t.h2,{id:"charger-des-donn\xe9es-disponibles-dans-un-r\xe9pertoire-local",children:"Charger des donn\xe9es disponibles dans un r\xe9pertoire local"}),"\n",(0,s.jsxs)(t.p,{children:["Si vous \xe9crivez simplement un script qui tournera en Node.js sur une machine et qui chargera les donn\xe9es depuis son syst\xe8me de fichier, utilisez ",(0,s.jsx)(t.a,{href:"https://github.com/bimodata/bimo/tree/main/public/core/utils/get-entity-from-oir-data-at-path",children:(0,s.jsx)(t.code,{children:"@bimo/core-utils-get-entity-from-oir-data-at-path"})}),". Ce package lit les fichiers du dossier que vous lui passez en param\xe8tre, se base sur les extensions pour distinguer le fichier de contr\xf4le et les fichiers de donn\xe9es, et charge les donn\xe9es dans des entit\xe9s Bimo."]}),"\n",(0,s.jsx)(t.h3,{id:"exemple",children:"Exemple"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Exportez des horaires de v\xe9hicules depuis HASTUS en utilisant l'",(0,s.jsx)(t.code,{children:"oig"})," standard ",(0,s.jsx)(t.code,{children:"hastus_vehicle_schedule.id"})]}),"\n",(0,s.jsxs)(t.li,{children:["R\xe9cup\xe9rez le fichier ",(0,s.jsx)(t.code,{children:"oir"})," standard ",(0,s.jsx)(t.code,{children:"hastus_vehicle_schedule.oir"})]}),"\n",(0,s.jsxs)(t.li,{children:["D\xe9posez le fichier ",(0,s.jsx)(t.code,{children:"oir"})," et les fichiers de donn\xe9es dans un m\xeame dossier et notez le chemin complet de ce dossier."]}),"\n",(0,s.jsx)(t.li,{children:"Vous pouvez maintenant charger ces donn\xe9es avec le script ci-dessous"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="script.js"',children:"\r\nconst { getEntityFromOirDataAtPath } = require('@bimo/core-utils-get-entity-from-oir-data-at-path');\r\nconst { VehicleSchedulesCollection } = require('@bimo/core-entities');\r\n\r\nconst pathToFolder = `C:\\path\\to\\folder`;\r\n\r\nasync function main() {\r\n  const myVehicleSchedulesCollection = await getEntityFromOirDataAtPath(pathToFolder, VehicleSchedulesCollection);\r\n  \r\n  // You can now do whatever you want with myVehicleSchedulesCollection ...\r\n  console.log(myVehicleSchedulesCollection.longLoggingOutput); \r\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"options",children:"Options"}),"\n",(0,s.jsxs)(t.p,{children:["N'h\xe9sitez pas \xe0 consulter le ",(0,s.jsx)(t.a,{href:"https://github.com/bimodata/bimo/tree/main/public/core/utils/get-entity-from-oir-data-at-path",children:"readme"})," du package et ses tests unitaires pour un vision compl\xe8te des options disponibles."]}),"\n",(0,s.jsx)(t.p,{children:"Sachez toutefois qu'il est possible de sp\xe9cifier si on souhaite lire plusieurs fichiers de donn\xe9es, auquel cas la fonction renverra un tableau contenant une entit\xe9 par fichier, ou un seul, auquel cas la fonction lira le premier qu'elle trouve et renverra directement l'entit\xe9 concern\xe9e."}),"\n",(0,s.jsx)(t.p,{children:"Il est \xe9galement possible de personnaliser les extensions (ou m\xeame les noms) de fichiers qui sont interpr\xe9t\xe9s comme fichier de contr\xf4le ou fichiers de donn\xe9es."}),"\n",(0,s.jsx)(t.h2,{id:"charger-des-donn\xe9es-dans-une-architecture-plus-complexe",children:"Charger des donn\xe9es dans une architecture plus complexe"}),"\n",(0,s.jsxs)(t.p,{children:["Dans une application plus complexe o\xf9 vous ne pouvez pas simplement lire les fichiers dans un r\xe9pertoire, vous pouvez utiliser le package ",(0,s.jsx)(t.a,{href:"https://github.com/bimodata/bimo/tree/main/public/core/services/get-entity-from-oir-data-string-and-control-file",children:(0,s.jsx)(t.code,{children:"@bimo/core-services-get-entity-from-oir-data-string-and-control-file"})}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Son fonctionnement est tr\xe8s similaire \xe0 celui de ",(0,s.jsx)(t.a,{href:"https://github.com/bimodata/bimo/tree/main/public/core/utils/get-entity-from-oir-data-at-path",children:(0,s.jsx)(t.code,{children:"@bimo/core-utils-get-entity-from-oir-data-at-path"})})," mais cette fois, plut\xf4t que de passer le chemin vers un r\xe9pertoire, on passe directement le contenu du fichier de donn\xe9es et du fichier de contr\xf4le sous forme de ",(0,s.jsx)(t.code,{children:"string"}),". \xc0 vous de voir comment obtenir ces strings."]}),"\n",(0,s.jsx)(t.h3,{id:"exemple-1",children:"Exemple"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="someLambdaFunction.js"',children:"\r\nconst fetch = require(\"isomorphic-unfetch\");\r\n\r\nconst getEntityFromOirDataStringAndControlFile = require('@bimo/core-services-get-entity-from-oir-data-string-and-control-file');\r\nconst { VehicleSchedulesCollection } = require('@bimo/core-entities');\r\n\r\nlet url = \"https://some.api.that.will.return.data/\";\r\n\r\nexports.handler = async function (event) {\r\n  const res = await fetch(url);\r\n  const { oirDataString, oirControlFileString } = await res.json();\r\n\r\n  const myVehicleSchedulesCollection = await getEntityFromOirDataStringAndControlFile(\r\n    {oirDataString, oirControlFileString, EntityConstructor: VehicleSchedulesCollection}\r\n  );\r\n\r\n  // Do whatever you want with the vehicle schedules collection\r\n  // For example count the total number of trips\r\n  const totalCountOftrips = myVehicleSchedulesCollection.tripsCollectionOfAllTripsOfAllVscs.count();\r\n\r\n  return totalCountOftrips;\r\n};\n"})})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},3023:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>l});var s=i(3696);const n={},r=s.createContext(n);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);