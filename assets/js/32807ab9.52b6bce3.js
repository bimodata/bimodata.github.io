"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[379],{2363:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var s=n(4848),l=n(8453),i=n(6888);const r={slug:"r\xe9concilier-les-lieux-de-deux-syst\xe8mes-diff\xe9rents-avec-find-best-match-for-target-among-candidates",title:"R\xe9concilier les lieux de deux syst\xe8mes diff\xe9rents",lead:"Le service Bimo `findBestMatchForTargetAmongCandidates` permet de trouver la meilleure association entre des objets par un syst\xe8me d'it\xe9rations successives.",date:"2022-12-13",authors:["gael"],tags:["findBestMatchForTargetAmongCandidates","lieux"],hide_blog_post_date:!0},d=void 0,a={permalink:"/examples/r\xe9concilier-les-lieux-de-deux-syst\xe8mes-diff\xe9rents-avec-find-best-match-for-target-among-candidates",source:"@site/examples/r\xe9concilier-les-lieux-de-deux-syst\xe8mes-diff\xe9rents-avec-find-best-match-for-target-among-candidates.mdx",title:"R\xe9concilier les lieux de deux syst\xe8mes diff\xe9rents",description:"Le service Bimo findBestMatchForTargetAmongCandidates permet de trouver la meilleure association entre des objets par un syst\xe8me d'it\xe9rations successives. Voici quelques exemples d'utilisations de ce service:",date:"2022-12-13T00:00:00.000Z",tags:[{inline:!0,label:"findBestMatchForTargetAmongCandidates",permalink:"/examples/tags/find-best-match-for-target-among-candidates"},{inline:!0,label:"lieux",permalink:"/examples/tags/lieux"}],hasTruncateMarker:!1,authors:[{name:"Ga\xebl Ham\xe9on",title:"Cr\xe9ateur de Bimo",url:"https://github.com/gaelhameon",imageURL:"https://github.com/gaelhameon.png",key:"gael"}],frontMatter:{slug:"r\xe9concilier-les-lieux-de-deux-syst\xe8mes-diff\xe9rents-avec-find-best-match-for-target-among-candidates",title:"R\xe9concilier les lieux de deux syst\xe8mes diff\xe9rents",lead:"Le service Bimo `findBestMatchForTargetAmongCandidates` permet de trouver la meilleure association entre des objets par un syst\xe8me d'it\xe9rations successives.",date:"2022-12-13",authors:["gael"],tags:["findBestMatchForTargetAmongCandidates","lieux"],hide_blog_post_date:!0},unlisted:!1,nextItem:{title:"Cr\xe9er un nouveau service Bimo",permalink:"/examples/creation-du-service-get-bbox-for-place"}},c={authorsImageUrls:[void 0]},o=[{value:"Probl\xe8me",id:"probl\xe8me",level:2},...i.RM,{value:"Aper\xe7u des donn\xe9es",id:"aper\xe7u-des-donn\xe9es",level:2},{value:"Donn\xe9es du syst\xe8me maison",id:"donn\xe9es-du-syst\xe8me-maison",level:3},{value:"Donn\xe9es de l&#39;environnement Hastus",id:"donn\xe9es-de-lenvironnement-hastus",level:3},{value:"Principe du traitement",id:"principe-du-traitement",level:2},{value:"Concepts de <code>findBestMatchForTargetAmongCandidates</code>",id:"concepts-de-findbestmatchfortargetamongcandidates",level:2},{value:"Principe de fonctionnement",id:"principe-de-fonctionnement",level:3},{value:"<code>target</code> et <code>candidates</code>",id:"target-et-candidates",level:3},{value:"Phase 1 : R\xe9duire la liste de candidats",id:"phase-1--r\xe9duire-la-liste-de-candidats",level:3},{value:"Phase 1A: filterPredicate",id:"phase-1a-filterpredicate",level:4},{value:"Phase 1B: regrouper les candidats et conserver le groupe qui correspond \xe0 une clef calcul\xe9e sur la cible",id:"phase-1b-regrouper-les-candidats-et-conserver-le-groupe-qui-correspond-\xe0-une-clef-calcul\xe9e-sur-la-cible",level:4},{value:"Phase 2 : trouver le meilleur candidat parmi ceux qui restent",id:"phase-2--trouver-le-meilleur-candidat-parmi-ceux-qui-restent",level:3},{value:"\xc9tapes de nettoyage",id:"\xe9tapes-de-nettoyage",level:2},{value:"Mise en oeuvre",id:"mise-en-oeuvre",level:2},{value:"Conclusion",id:"conclusion",level:2}];function x(e){const t={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Le service Bimo ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," permet de trouver la meilleure association entre des objets par un syst\xe8me d'it\xe9rations successives. Voici quelques exemples d'utilisations de ce service:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Trouver la variante (ou le ",(0,s.jsx)(t.em,{children:"voyage mod\xe8le"}),") qui correspond le mieux \xe0 un voyage import\xe9 d'un syst\xe8me maison pour ensuite enrichir ce voyage avec les infos de la variante (ou du ",(0,s.jsx)(t.em,{children:"voyage mod\xe8le"}),")"]}),"\n",(0,s.jsx)(t.li,{children:'R\xe9concilier des listes de lieux sur la base de libell\xe9s qui varient l\xe9g\xe8rement. Par exemple: "Paris Nord" vs "Gare du Nord"'}),"\n",(0,s.jsx)(t.li,{children:"Trouver le noeud ou l'arc qui correspond le mieux \xe0 un lieu dans un graphe repr\xe9sentant le r\xe9seau"}),"\n",(0,s.jsx)(t.li,{children:"..."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Chacune de ces utilisations est un peu abstraite et difficile \xe0 d\xe9crire en une phrase ... n'h\xe9sitez pas \xe0 laisser un commentaire si vous aimeriez en savoir plus sur l'une d'entre elles."}),"\n",(0,s.jsx)(t.p,{children:"Dans cet article, nous allons nous int\xe9resser \xe0 une utilisation relativement simple de ce service:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Trouver le lieu Hastus qui correspond le mieux \xe0 un lieu en provenance d'un syst\xe8me maison"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"probl\xe8me",children:"Probl\xe8me"}),"\n","\n",(0,s.jsx)(i.Ay,{}),"\n",(0,s.jsxs)(t.p,{children:["Le service ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," est parfait pour r\xe9pondre \xe0 ce type de probl\xe8me."]}),"\n",(0,s.jsx)(t.h2,{id:"aper\xe7u-des-donn\xe9es",children:"Aper\xe7u des donn\xe9es"}),"\n",(0,s.jsx)(t.h3,{id:"donn\xe9es-du-syst\xe8me-maison",children:"Donn\xe9es du syst\xe8me maison"}),"\n",(0,s.jsx)(t.p,{children:"Le seul \xe9l\xe9ment \"standard\" dans ces donn\xe9es est le code UIC8 de la gare. Ensuite, on trouve des id incr\xe9mentaux pour chaque voie, mais en y regardant de plus pr\xe8s, on se rend compte qu'une m\xeame voie semble pouvoir exister avec plusieurs ID. Dans les exemples de donn\xe9es ci-dessous, les id 1 et 2 semblent tous deux d\xe9signer la voie B de Bellegarde, l'une dans le sens Culoz vers Gen\xe8ve et l'inverse pour l'autre."}),"\n",(0,s.jsx)(t.p,{children:"On trouve par ailleurs deux champs contenant:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:'le libell\xe9 "infra" de la voie (celui utilis\xe9 par les agents SNCF R\xe9seau)'}),"\n",(0,s.jsx)(t.li,{children:'le libell\xe9 "commercial" de la voie (celui utilis\xe9 par les agents commerciaux et les passagers)'}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Par exemple, dans les donn\xe9es ci-dessous, on voit qu'\xe0 Libourne, la voie qui est connue comme voie B pour les passagers semble \xeatre connue comme voie 2 pour les agents SNCF R\xe9seau. Mais on voit \xe9galement que dans certains cas, le libell\xe9 commercial a \xe9t\xe9 r\xe9p\xe9t\xe9 entre parenth\xe8ses dans le champ du libell\xe9 infra, et inversement."}),"\n",(0,s.jsx)(t.p,{children:"En synth\xe8se, ces donn\xe9es ne sont pas particuli\xe8rement propres: elles ont \xe9t\xe9 saisies manuellement par des utilisateurs vari\xe9s dans un syst\xe8me o\xf9 ils pouvaient saisir ce qu'ils voulaient dans un champ texte libre. Un nettoyage va s'imposer."}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Cliquez ici pour un aper\xe7u des donn\xe9es"}),(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"idVoie"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"uic8"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"libGare"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"libInfraVoie"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"libCommVoie"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (CUZ>GCO)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (CUZ>GCO)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (GCO>CUZ)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (GCO>CUZ)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A(CUZ>GCO"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A (CUZ>GCO)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"4"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"G"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"G"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"6"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E (GCO>CUZ)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E (GCO>CUZ)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"7"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C (CUZ>GCO)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"8"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C (GCO>CUZ)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C (GCO>CUZ)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"9"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"}}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A (GCO>CUZ)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"10"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E (CUZ>GCO)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E (CUZ>GCO)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"11"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"12"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2(B)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B(2)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"13"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C(1)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"14"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2(B)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (2)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"15"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"4(A)"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A(4)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"16"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"D(3)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"17"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"D(3)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"18"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"D(3)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"19"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C(1)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"20"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"C(1)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"21"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"4"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"22"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"23"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"24"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87741439"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"L\xe9pin-le-Lac"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"D"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B (Direct)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"25"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"87741439"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"L\xe9pin-le-Lac"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A (Evi)"})]})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"donn\xe9es-de-lenvironnement-hastus",children:"Donn\xe9es de l'environnement Hastus"}),"\n",(0,s.jsxs)(t.p,{children:["La plupart des attributs qui nous int\xe9ressent ici sont en r\xe9alit\xe9 sp\xe9cifiques \xe0 la version SNCF d'Hastus. Les attributs ",(0,s.jsx)(t.code,{children:"Code R\xe9seau"}),", ",(0,s.jsx)(t.code,{children:"Code Immuable"})," et ",(0,s.jsx)(t.code,{children:"Code Chantier"})," ont \xe9t\xe9 cr\xe9\xe9s pour stocker les codes UIC de la gare \xe0 laquelle correspond chaque lieu. Le code UIC8 disponible dans les donn\xe9es du syst\xe8me maison correspond donc aux deux derniers caract\xe8res du code r\xe9seau, accol\xe9s au code immuable."]}),"\n",(0,s.jsxs)(t.p,{children:["Les attributs ",(0,s.jsx)(t.code,{children:"Id Voie Agathe"})," et ",(0,s.jsx)(t.code,{children:"Libell\xe9 Voie Agathe"})," donnent des indications sur le nom des voies, mais encore une fois, ne sont pas standardis\xe9s."]}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Cliquez ici pour un aper\xe7u des donn\xe9es"}),(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcIdentifier"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcDescription"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcCodeReseau"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcCodeImmuable"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcCodeChantier"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcIdVoieAgathe"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"plcLibelleVoieAgathe"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LI1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne/BV - V1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V1"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LI2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne/BV - V2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V2"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LI3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne/BV - 3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"3"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LI4"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne/BV - 4"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"4"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"4"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LI5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Libourne/BV - 5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"584052"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"5"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LPLd"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"L\xe9pin-le-Lac-La Bauche/00 - UNIQUE"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"741439"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"00"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"UNIQUE"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"D"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"LPLe"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"L\xe9pin-le-Lac-La Bauche/00 - E"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"741439"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"00"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"EVIT"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGD1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - V1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V1"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V1"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGD1h"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - V1H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V1H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V1H"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGD2h"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - V2H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V2H"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V2H"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGD5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - V5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V5"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V5"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGDa"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - A"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"A"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGDb"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - B"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"B"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGDe-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - VE-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"VE-"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"E"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGDfi"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - FI"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"FI"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"FI"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BGDg"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bellegarde (Ain)/BV - V2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"0087"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"745000"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"BV"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"V2"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"VG"})]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"principe-du-traitement",children:"Principe du traitement"}),"\n",(0,s.jsxs)(t.p,{children:["\xc9tant donn\xe9 qu'une m\xeame voie peut exister sous plusieurs ID dans le syst\xe8me maison, mais pas dans Hastus, on va it\xe9rer sur les voies du syst\xe8me maison, et tenter de trouver pour chacune la meilleure voie Hastus possible. Plusieurs voies du syst\xe8me maison pourront donc \xeatre associ\xe9es \xe0 la m\xeame voie Hastus. Mais certaines voies Hastus pourraient n'\xeatre associ\xe9es \xe0 aucune voie du syst\xe8me maison. Dans notre cas, les ",(0,s.jsx)(t.em,{children:"cibles"})," sont donc les voies du syst\xe8me maison et les ",(0,s.jsx)(t.em,{children:"candidats"})," sont les lieux Hastus."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"}),", comme son nom l'indique, trouve une\ncorrespondance pour ",(0,s.jsxs)(t.strong,{children:["une ",(0,s.jsx)(t.em,{children:"cible"})]})," parmi ",(0,s.jsxs)(t.strong,{children:["plusieurs ",(0,s.jsx)(t.em,{children:"candidats"})]})," et n'est\npas appropri\xe9 pour les cas o\xf9 on souhaite des correspondances strictes ",(0,s.jsx)(t.em,{children:"un\npour un"})," entre deux listes. Il faut alors utiliser d'autres services, comme\n",(0,s.jsx)(t.code,{children:"matchTwoListsOfString"}),", ou utiliser ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"}),"\nmais ajouter de la logique autour pour retirer les candidats de la liste \xe0\nmesure qu'ils sont associ\xe9s aux cibles."]})}),"\n",(0,s.jsxs)(t.p,{children:["Pour une ",(0,s.jsx)(t.em,{children:"cible"})," donn\xe9e, la liste de ",(0,s.jsx)(t.em,{children:"candidats"})," sera constitu\xe9e des lieux Hastus qui ont le m\xeame code UIC8 que la cible. Dans cette liste de candidat, on va alors essayer d'en trouver un qui a le m\xeame ",(0,s.jsx)(t.em,{children:"nom de voie"})," que la cible. Mais comme on l'a vu pr\xe9c\xe9demment, le ",(0,s.jsx)(t.em,{children:"nom de voie"})," n'est pas standard, et dans beaucoup de cas, les noms de voies devront \xeatre nettoy\xe9s si on veut qu'ils correspondent entre eux."]}),"\n",(0,s.jsxs)(t.p,{children:["C'est ici que le m\xe9canisme it\xe9ratif de ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," sera utile."]}),"\n",(0,s.jsxs)(t.h2,{id:"concepts-de-findbestmatchfortargetamongcandidates",children:["Concepts de ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})]}),"\n",(0,s.jsxs)(t.p,{children:["Ci-dessous, un r\xe9sum\xe9 du README de ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," (auquel vous devriez vous r\xe9f\xe9rer pour plus de d\xe9tails) avec la traduction des concepts pour notre cas pr\xe9cis."]}),"\n",(0,s.jsx)(t.h3,{id:"principe-de-fonctionnement",children:"Principe de fonctionnement"}),"\n",(0,s.jsxs)(t.p,{children:["On essaie en plusieurs it\xe9rations de trouver la meilleure correspondance pour une ",(0,s.jsx)(t.em,{children:"cible"})," parmi plusieurs ",(0,s.jsx)(t.em,{children:"candidats"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"\xc0 chaque it\xe9ration, on passe par deux phases:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"R\xe9duire la liste de candiats"}),"\n",(0,s.jsxs)(t.li,{children:["Calculer une ",(0,s.jsx)(t.em,{children:"distance"})," entre la ",(0,s.jsx)(t.em,{children:"cible"})," et chaque ",(0,s.jsx)(t.em,{children:"candidat"}),", et d\xe9clarer un ",(0,s.jsx)(t.em,{children:"bestMatch"})," si les ",(0,s.jsx)(t.em,{children:"crit\xe8res"})," sont atteints"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Ces principes donnent beaucoup de flexibilit\xe9 et permettent d'ajuster rapidement et facilement les crit\xe8res afin d'optimiser la performance et la qualit\xe9 des correspondances. Par exemple:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"on d\xe9fini une premi\xe8re it\xe9ration tr\xe8s stricte, qui cible une liste r\xe9duite de candidats, avec un calcul de distance simple pour abattre rapidement une grosse partie du travail"}),"\n",(0,s.jsx)(t.li,{children:"dans les it\xe9rations suivantes, on peut se permettre de cibler plus de candidats et d'avoir des crit\xe8res plus complexes, car on sait qu'elle ne seront ex\xe9cut\xe9es que sur les quelques cibles restantes"}),"\n",(0,s.jsx)(t.li,{children:"si \xe7a n'a toujours pas suffi, on peut faire des tentatives carr\xe9ment loufoques dans les derni\xe8res it\xe9rations, quitte \xe0 traiter avec un grain de sel les r\xe9sultats obtenus dans celles-ci"}),"\n"]}),"\n",(0,s.jsxs)(t.h3,{id:"target-et-candidates",children:[(0,s.jsx)(t.code,{children:"target"})," et ",(0,s.jsx)(t.code,{children:"candidates"})]}),"\n",(0,s.jsxs)(t.p,{children:["La ",(0,s.jsx)(t.code,{children:"target"})," ou ",(0,s.jsx)(t.em,{children:"cible"})," est l'objet pour lequel on recherche une correspondance parmi plusieurs ",(0,s.jsx)(t.code,{children:"candidates"})," ou ",(0,s.jsx)(t.em,{children:"candidats"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Dans notre cas, la ",(0,s.jsx)(t.em,{children:"cible"})," sera une voie du syst\xe8me maison et les ",(0,s.jsx)(t.em,{children:"candidats"})," seront les lieux Hastus."]}),"\n",(0,s.jsx)(t.h3,{id:"phase-1--r\xe9duire-la-liste-de-candidats",children:"Phase 1 : R\xe9duire la liste de candidats"}),"\n",(0,s.jsxs)(t.p,{children:["Les options pour cette phase sont d\xe9finies sous la cl\xe9 ",(0,s.jsx)(t.code,{children:"candidatesFilteringConfig"})," de la configuration globale.\nSi cette cl\xe9 n'est pas d\xe9finie, tous les candidats sont utilis\xe9s. Si la clef est d\xe9finie, les candidats sont filtr\xe9s dans deux sous-phases."]}),"\n",(0,s.jsx)(t.h4,{id:"phase-1a-filterpredicate",children:"Phase 1A: filterPredicate"}),"\n",(0,s.jsx)(t.p,{children:"Cette phase est utile pour \xe9liminer des candidats sur la base de crit\xe8res fixes, qui ne varient pas en fonction de la cible."}),"\n",(0,s.jsxs)(t.p,{children:["Elle n'est pas utilis\xe9e dans notre cas car nos filtres fixes sont les m\xeames pour toutes les it\xe9rations, donc nous les appliquons une fois pour toute dans le script avant m\xeame de rentrer dans ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})]}),"\n",(0,s.jsx)(t.h4,{id:"phase-1b-regrouper-les-candidats-et-conserver-le-groupe-qui-correspond-\xe0-une-clef-calcul\xe9e-sur-la-cible",children:"Phase 1B: regrouper les candidats et conserver le groupe qui correspond \xe0 une clef calcul\xe9e sur la cible"}),"\n",(0,s.jsx)(t.p,{children:"Cette phase permet de ne conserver que les candidats qui ont une caract\xe9ristique commune avec la cible."}),"\n",(0,s.jsx)(t.p,{children:"D'abord, on regroupe tous les candidats sur la base de cette caract\xe9ristique. Ensuite, on calcule (si n\xe9cessaire) la valeur de cette caract\xe9ristique pour la cible, et on ne conserve que les candidats qui ont la m\xeame valeur que la cible."}),"\n",(0,s.jsx)(t.p,{children:"Dans notre cas, la caract\xe9ristique commune qui nous int\xe9resse est le code UIC8. On va regrouper les lieux Hastus par code UIC8 et ne consid\xe9rer que ceux qui ont le m\xeame que la voie maison."}),"\n",(0,s.jsx)(t.h3,{id:"phase-2--trouver-le-meilleur-candidat-parmi-ceux-qui-restent",children:"Phase 2 : trouver le meilleur candidat parmi ceux qui restent"}),"\n",(0,s.jsxs)(t.p,{children:["Les options pour cette phase sont d\xe9finies sous la cl\xe9 ",(0,s.jsx)(t.code,{children:"getBestMatchConfig"})," de la configuration globale. Plusieurs options de configuration existent, mais les deux plus importantes sont ",(0,s.jsx)(t.code,{children:"distanceFunction"})," et ",(0,s.jsx)(t.code,{children:"maxDistance"})]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"distanceFunction"})," est une fonction qui doit calculer une ",(0,s.jsx)(t.em,{children:"distance"})," entre la cible et le candidat. Pour un candidat qui correspond parfaitement \xe0 la cible, ",(0,s.jsx)(t.code,{children:"distanceFunction"})," devrait renvoyer ",(0,s.jsx)(t.code,{children:"0"}),". Moins le candidat correspond \xe0 la cible, plus la valeur renvoy\xe9e par ",(0,s.jsx)(t.code,{children:"distanceFunction"})," devrait \xeatre grande."]}),"\n",(0,s.jsxs)(t.p,{children:["Si aucun des candidats n'a une valeur de ",(0,s.jsx)(t.code,{children:"0"}),", alors c'est le candidat qui a la plus petite valeur qui est consid\xe9r\xe9 comme la meilleure correspondance, \xe0 condition que cette valeur soit inf\xe9rieure \xe0 la valeur d\xe9finie dans ",(0,s.jsx)(t.code,{children:"maxDistance"})]}),"\n",(0,s.jsxs)(t.p,{children:["Dans notre cas, on ne va pas utiliser ce m\xe9canisme \xe0 son plein potentiel. Notre ",(0,s.jsx)(t.code,{children:"distanceFunction"})," va simplement comparer les libell\xe9s de voie, apr\xe8s les avoir plus ou moins nettoy\xe9s. Si elle trouve une correspondance exacte entre libell\xe9s de voies nettoy\xe9s, elle va renvoyer ",(0,s.jsx)(t.code,{children:"0"}),". Sinon, elle va renvoyer +infini, et il faudra passer au candidat suivant, puis \xe0 l'it\xe9ration suivante le cas \xe9ch\xe9ant."]}),"\n",(0,s.jsx)(t.h2,{id:"\xe9tapes-de-nettoyage",children:"\xc9tapes de nettoyage"}),"\n",(0,s.jsx)(t.p,{children:"\xc0 chaque it\xe9ration, on fait les 4 comparaisons possibles:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Libell\xe9 Infra vs Id Voie"}),"\n",(0,s.jsx)(t.li,{children:"Libell\xe9 Commercial vs Id voie"}),"\n",(0,s.jsx)(t.li,{children:"Libell\xe9 Infra vs Libell\xe9 Voie"}),"\n",(0,s.jsx)(t.li,{children:"Libell\xe9 Commercial vs Libell\xe9 Voie"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"On consid\xe8re qu'un lieu Hastus correspond \xe0 la voie maison d\xe8s que les valeurs sont les m\xeames pour une des comparaison."}),"\n",(0,s.jsx)(t.p,{children:'\xc0 chaque fois, on applique des "nettoyages" aux valeurs de la cible et des candidats avant de les comparer.'}),"\n",(0,s.jsx)(t.p,{children:'\xc0 chaque it\xe9ration, on ajoute des "nettoyages" en plus de ceux faits aux it\xe9rations pr\xe9c\xe9dentes. Par exemple:'}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"mettre tout en minuscules"}),"\n",(0,s.jsx)(t.li,{children:'retirer les "V" ou "v" au d\xe9but des libell\xe9s'}),"\n",(0,s.jsx)(t.li,{children:"retirer tout texte entre parenth\xe8ses"}),"\n",(0,s.jsx)(t.li,{children:"transformer UNIQUE en U, BIS en B, TER en T"}),"\n",(0,s.jsx)(t.li,{children:"retirer les espaces au milieu des libell\xe9s"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"mise-en-oeuvre",children:"Mise en oeuvre"}),"\n",(0,s.jsxs)(t.p,{children:["Ci-dessous, un aper\xe7u comment\xe9 de la fonction qui utilise ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," dans le script."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:'title="getBestMatchResultByExternalTrack.js"',children:"/** Les utilitaires ci-dessous seront bri\xe8vement d\xe9crits quand ils seront\n * utilis\xe9s dans le code */\nconst findBestMatch = require('@bimo/core-utils-find-best-match-for-target-among-candidates');\nconst {\n  cleanStringUsingRegexAndReplacePairs,\n} = require('@bimo/core-utils-string');\nconst matchTwoListsOfStrings = require('@bimo/core-utils-match-two-lists-of-strings');\nconst { countBy } = require('lodash');\n\n/** Cette fonction est appell\xe9e par le script, qui s'est charg\xe9 par ailleurs\n * - de charger les voies maisons et d'en faire un array d'objets\n *   (externalTracks)\n * - de charger et pr\xe9-filtrer le jeu de lieux Hastus (placesCollection)\n */\nfunction getBestMatchResultByExternalTrack(\n  externalTracks,\n  placesCollection,\n  logger\n) {\n  /** Dans notre cas, on va filtrer les lieux de la m\xeame mani\xe8re pour toutes les\n   * it\xe9rations. On d\xe9finit donc une seule fois candidatesFilteringConfig\n   * Mais gardez en t\xeate qu'on peut parfaitement le faire varier \xe0 chaque\n   * it\xe9ration quand c'est utile.\n   */\n  const candidatesFilteringConfig = {\n    /** La target est la voie maison, qui poss\xe8de directement une cl\xe9 'uic8' */\n    getKeyFromTargetConfig: 'uic8',\n    /** Il n'y a pas directement de cl\xe9 \xe9quivalent sur les lieux Hastus,\n     * on la fabrique \xe0 la vol\xe9e avec la fonction ci-dessous */\n    groupCandidatesByConfig: (place) =>\n      `${place.plcCodeReseau.substr(-2)}${place.plcCodeImmuable}`,\n  };\n\n  /** La \"distanceFunction\" varie \xe0 chaque it\xe9ration, mais elle a toujours la\n   * m\xeame forme. On va donc cr\xe9er une \"distanceFunctionFactory\": une fonction\n   * qui retourne une fonction.\n   * \xc0 chaque it\xe9ration, on va appeler la factory en lui passant des\n   * regexAndReplacePairs plus ou moins complexes pour transformer les strings.\n   * On obtiendra alors une \"distanceFunction\" classique qui transforme les\n   * strings, puis les compare, et retourne 0 s'il y a un match, +infini sinon.\n   * */\n  const distanceFunctionFactory =\n    (regexAndReplacePairs) => (externalTrackPlace, hastusPlace) => {\n      /** Pour simplifier les manipulations, on regroupe les strings qui nous int\xe9ressent */\n      const rawExternalStrings = [\n        externalTrackPlace.libInfraVoie,\n        externalTrackPlace.libCommVoie,\n      ];\n      const rawHastusStrings = [\n        hastusPlace.plcIdVoieAgathe,\n        hastusPlace.plcLibelleVoieAgathe,\n      ];\n\n      /** cleanStringUsingRegexAndReplacePairs applique successivement des\n       * expressions r\xe9guli\xe8res \xe0 une string pour la nettoyer */\n      const cleanExternalStrings = rawExternalStrings.map((s) =>\n        cleanStringUsingRegexAndReplacePairs(\n          s,\n          regexAndReplacePairs\n        ).toLowerCase()\n      );\n      const cleanHastusStrings = rawHastusStrings.map((s) =>\n        cleanStringUsingRegexAndReplacePairs(\n          s,\n          regexAndReplacePairs\n        ).toLowerCase()\n      );\n\n      /** En l'utilisant avec l'option { returnOnFirstMatch: true }\n       * matchTwoListsOfStrings permet de savoir rapidement s'il y a une\n       * correspondance exacte entre n'importe quelles 2 strings de deux\n       * listes  */\n      const { matched } = matchTwoListsOfStrings(\n        [cleanExternalStrings, cleanHastusStrings],\n        { returnOnFirstMatch: true }\n      );\n\n      return matched.length === 0 ? Number.POSITIVE_INFINITY : 0;\n    };\n\n  /**On stockera les r\xe9sultats dans cette variable */\n  const bestMatchResultByExternalTrack = new Map();\n\n  /** Les regexAndReplacePairs ci-dessous vont permettre de nettoyer les\n   * strings. Si besoin de plus de d\xe9tails sur le fonctionnement des\n   * regex, n'h\xe9sitez pas \xe0 laisser un commentaire sous cet article */\n  const removeVRegexAndReplacePair = ['/^[vV](.+)$/', '$1'];\n  const removeParenthesisRegexAndReplacePair = [\n    '/(\\\\w+).*(\\\\(.+\\\\))/gim',\n    '$1',\n  ];\n  const transformUniqueIntoU = ['/^UNIQUE$/i', 'U'];\n  const transformBisIntoB = ['/BIS/i', 'B'];\n  const transformTerIntoT = ['/TER/i', 'T'];\n  const removeSpaces = ['/ /g', ''];\n\n  externalTracks.forEach((externalTrack) => {\n    /** Noter que findBestMatch... accepte les candidates sous la forme d'un\n     * array ou d'une collection. La collection est pr\xe9f\xe9rable car permet de\n     * profiter du cache pour am\xe9liorer la performance */\n    const bestMatchResult = findBestMatch(\n      { target: externalTrack, candidates: placesCollection },\n      {\n        iterationConfigs: [\n          {\n            iterationName: '1 = tout mettre en minuscule',\n            candidatesFilteringConfig /** Voir ligne 25 */,\n            getBestMatchConfig: {\n              detailedResults: true,\n              distanceFunction: distanceFunctionFactory([\n                /**Aucun nettoyage particulier pour cette it\xe9ration */\n              ]),\n              maxDistance: 1,\n            },\n          },\n          {\n            iterationName:\n              '2 = 1 + retrait des \"V\" ou \"v\" au d\xe9but des noms de voies',\n            candidatesFilteringConfig,\n            getBestMatchConfig: {\n              detailedResults: true,\n              distanceFunction: distanceFunctionFactory([\n                removeVRegexAndReplacePair,\n              ]),\n              maxDistance: 1,\n            },\n          },\n          {\n            iterationName: '3 = 2 + retrait du texte entre parenth\xe8ses',\n            candidatesFilteringConfig,\n            getBestMatchConfig: {\n              detailedResults: true,\n              distanceFunction: distanceFunctionFactory([\n                removeVRegexAndReplacePair,\n                removeParenthesisRegexAndReplacePair,\n              ]),\n              maxDistance: 1,\n            },\n          },\n          {\n            iterationName: '4 = 3 + transfo UNIQUE > U, BIS > B, TER > T',\n            candidatesFilteringConfig,\n            getBestMatchConfig: {\n              detailedResults: true,\n              distanceFunction: distanceFunctionFactory([\n                removeVRegexAndReplacePair,\n                removeParenthesisRegexAndReplacePair,\n                transformUniqueIntoU,\n                transformBisIntoB,\n                transformTerIntoT,\n              ]),\n              maxDistance: 1,\n            },\n          },\n          {\n            iterationName: '5 = 4 + retrait des espaces',\n            candidatesFilteringConfig,\n            getBestMatchConfig: {\n              detailedResults: true,\n              distanceFunction: distanceFunctionFactory([\n                removeVRegexAndReplacePair,\n                removeParenthesisRegexAndReplacePair,\n                transformUniqueIntoU,\n                transformBisIntoB,\n                transformTerIntoT,\n                removeSpaces,\n              ]),\n              maxDistance: 1,\n            },\n          },\n        ],\n      }\n    );\n    bestMatchResultByExternalTrack.set(externalTrack, bestMatchResult);\n  });\n\n  /** on laisse ce petit exemple de rapport minimaliste pour montrer que les\n   * r\xe9sultats incluent des infos sur l'it\xe9ration qui a produit le match */\n  const numberOfMatchesByIteration = countBy(\n    Array.from(bestMatchResultByExternalTrack.values()),\n    'indexOfIterationThatMatched'\n  );\n  logger.info(JSON.stringify(numberOfMatchesByIteration));\n\n  return bestMatchResultByExternalTrack;\n}\n\nmodule.exports = getBestMatchResultByExternalTrack;\n"})}),"\n",(0,s.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsxs)(t.p,{children:["M\xeame si cet exemple ne tire pas profit de toute la puissance de ",(0,s.jsx)(t.code,{children:"findBestMatchForTargetAmongCandidates"})," il illustre bien ",(0,s.jsx)(t.em,{children:"l'expressivit\xe9"})," rendue possible gr\xe2ce au syst\xe8me des it\xe9rations."]}),"\n",(0,s.jsx)(t.p,{children:"En quelques dizaines de lignes de code, on met en place une structure qui permet ensuite de s'amuser facilement avec les donn\xe9es, en ajoutant simplement de nouvelles it\xe9rations, mais en conservant beaucoup de puissance et de flexibilit\xe9."})]})}function u(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}},6888:(e,t,n)=>{n.d(t,{Ay:()=>d,RM:()=>i});var s=n(4848),l=n(8453);const i=[];function r(e){const t={li:"li",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"On a:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"d'une part, un environnement Hastus dans lequel l'ensemble du R\xe9seau Ferr\xe9 National fran\xe7ais est cartographi\xe9 dans le module Geo, et ou chaque voie \xe0 quai d'une gare commerciale est mod\xe9lis\xe9e par un lieu"}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"d'autre part, un outil SNCF maison o\xf9 des informations importantes sur les voies \xe0 quai ont \xe9t\xe9 saisies manuellement"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"On souhaite \xe9tablir une \xe9quivalence entre les r\xe9f\xe9rentiels de voies \xe0 quai de ces deux syst\xe8mes afin de pouvoir importer dans Hastus les informations saisies dans le syst\xe8me maison."})]})}function d(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(r,{...e})}):r(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>d});var s=n(6540);const l={},i=s.createContext(l);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);