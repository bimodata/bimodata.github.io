<!doctype html>
<html lang="fr" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-examples" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Réconcilier les lieux de deux systèmes différents | Bimo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://bimodata.github.io/img/bimo-social-card-fr.jpg"><meta data-rh="true" name="twitter:image" content="https://bimodata.github.io/img/bimo-social-card-fr.jpg"><meta data-rh="true" property="og:url" content="https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Réconcilier les lieux de deux systèmes différents | Bimo"><meta data-rh="true" name="description" content="Le service Bimo findBestMatchForTargetAmongCandidates permet de trouver la meilleure association entre des objets par un système d&#x27;itérations successives. Voici quelques exemples d&#x27;utilisations de ce service:"><meta data-rh="true" property="og:description" content="Le service Bimo findBestMatchForTargetAmongCandidates permet de trouver la meilleure association entre des objets par un système d&#x27;itérations successives. Voici quelques exemples d&#x27;utilisations de ce service:"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-12-13T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/gaelhameon"><meta data-rh="true" property="article:tag" content="findBestMatchForTargetAmongCandidates,lieux"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates" hreflang="fr"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/en/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates" hreflang="en"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates","mainEntityOfPage":"https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates","url":"https://bimodata.github.io/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates","headline":"Réconcilier les lieux de deux systèmes différents","name":"Réconcilier les lieux de deux systèmes différents","description":"Le service Bimo findBestMatchForTargetAmongCandidates permet de trouver la meilleure association entre des objets par un système d'itérations successives. Voici quelques exemples d'utilisations de ce service:","datePublished":"2022-12-13T00:00:00.000Z","author":{"@type":"Person","name":"Gaël Haméon","description":"Créateur de Bimo","url":"https://github.com/gaelhameon","image":"https://github.com/gaelhameon.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://bimodata.github.io/examples","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Bimo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Bimo Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/examples/rss.xml" title="Bimo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/examples/atom.xml" title="Bimo Atom Feed"><link rel="stylesheet" href="/assets/css/styles.c54dd6f3.css">
<script src="/assets/js/runtime~main.2229c1e6.js" defer="defer"></script>
<script src="/assets/js/main.95e10fbd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/bimo-dark-blue.png" alt="Logo Bimo" class="themedComponent_siVc themedComponent--light_hHel"><img src="/img/bimo-light-blue.png" alt="Logo Bimo" class="themedComponent_siVc themedComponent--dark_yETr"></div><b class="navbar__title text--truncate">Bimo</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/examples">Exemples</a><a class="navbar__item navbar__link" href="/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_kvP7"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">Français</a></li><li><a href="/en/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="mailto:gael.hameon@gmail.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/bimodata/bimo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_bzqh"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_CLW8 thin-scrollbar" aria-label="Navigation article de blog récent"><div class="sidebarItemTitle_DQfJ margin-bottom--md">Tous nos exemples</div><ul class="sidebarItemList_rvuc clean-list"><li class="sidebarItem__RMN"><a aria-current="page" class="sidebarItemLink_Ony9 sidebarItemLinkActive_MJ75" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates">Réconcilier les lieux de deux systèmes différents</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/examples/creation-du-service-get-bbox-for-place">Créer un nouveau service Bimo</a></li><li class="sidebarItem__RMN"><a class="sidebarItemLink_Ony9" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus">Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_Kdtz">Réconcilier les lieux de deux systèmes différents</h1><div class="container_iJTo margin-vert--md"></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_v1VX"><div class="avatar margin-bottom--sm"><a href="https://github.com/gaelhameon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/gaelhameon.png" alt="Gaël Haméon"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/gaelhameon" target="_blank" rel="noopener noreferrer"><span>Gaël Haméon</span></a></div><small class="avatar__subtitle">Créateur de Bimo</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Le service Bimo <code>findBestMatchForTargetAmongCandidates</code> permet de trouver la meilleure association entre des objets par un système d&#x27;itérations successives. Voici quelques exemples d&#x27;utilisations de ce service:</p>
<ul>
<li>Trouver la variante (ou le <em>voyage modèle</em>) qui correspond le mieux à un voyage importé d&#x27;un système maison pour ensuite enrichir ce voyage avec les infos de la variante (ou du <em>voyage modèle</em>)</li>
<li>Réconcilier des listes de lieux sur la base de libellés qui varient légèrement. Par exemple: &quot;Paris Nord&quot; vs &quot;Gare du Nord&quot;</li>
<li>Trouver le noeud ou l&#x27;arc qui correspond le mieux à un lieu dans un graphe représentant le réseau</li>
<li>...</li>
</ul>
<p>Chacune de ces utilisations est un peu abstraite et difficile à décrire en une phrase ... n&#x27;hésitez pas à laisser un commentaire si vous aimeriez en savoir plus sur l&#x27;une d&#x27;entre elles.</p>
<p>Dans cet article, nous allons nous intéresser à une utilisation relativement simple de ce service:</p>
<ul>
<li>Trouver le lieu Hastus qui correspond le mieux à un lieu en provenance d&#x27;un système maison</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="problème">Problème<a class="hash-link" aria-label="Lien direct vers Problème" title="Lien direct vers Problème" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#problème">​</a></h2>
<!-- -->
<p>On a:</p>
<ul>
<li>
<p>d&#x27;une part, un environnement Hastus dans lequel l&#x27;ensemble du Réseau Ferré National français est cartographié dans le module Geo, et ou chaque voie à quai d&#x27;une gare commerciale est modélisée par un lieu</p>
</li>
<li>
<p>d&#x27;autre part, un outil SNCF maison où des informations importantes sur les voies à quai ont été saisies manuellement</p>
</li>
</ul>
<p>On souhaite établir une équivalence entre les référentiels de voies à quai de ces deux systèmes afin de pouvoir importer dans Hastus les informations saisies dans le système maison.</p>
<p>Le service <code>findBestMatchForTargetAmongCandidates</code> est parfait pour répondre à ce type de problème.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="aperçu-des-données">Aperçu des données<a class="hash-link" aria-label="Lien direct vers Aperçu des données" title="Lien direct vers Aperçu des données" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#aperçu-des-données">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="données-du-système-maison">Données du système maison<a class="hash-link" aria-label="Lien direct vers Données du système maison" title="Lien direct vers Données du système maison" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#données-du-système-maison">​</a></h3>
<p>Le seul élément &quot;standard&quot; dans ces données est le code UIC8 de la gare. Ensuite, on trouve des id incrémentaux pour chaque voie, mais en y regardant de plus près, on se rend compte qu&#x27;une même voie semble pouvoir exister avec plusieurs ID. Dans les exemples de données ci-dessous, les id 1 et 2 semblent tous deux désigner la voie B de Bellegarde, l&#x27;une dans le sens Culoz vers Genève et l&#x27;inverse pour l&#x27;autre.</p>
<p>On trouve par ailleurs deux champs contenant:</p>
<ul>
<li>le libellé &quot;infra&quot; de la voie (celui utilisé par les agents SNCF Réseau)</li>
<li>le libellé &quot;commercial&quot; de la voie (celui utilisé par les agents commerciaux et les passagers)</li>
</ul>
<p>Par exemple, dans les données ci-dessous, on voit qu&#x27;à Libourne, la voie qui est connue comme voie B pour les passagers semble être connue comme voie 2 pour les agents SNCF Réseau. Mais on voit également que dans certains cas, le libellé commercial a été répété entre parenthèses dans le champ du libellé infra, et inversement.</p>
<p>En synthèse, ces données ne sont pas particulièrement propres: elles ont été saisies manuellement par des utilisateurs variés dans un système où ils pouvaient saisir ce qu&#x27;ils voulaient dans un champ texte libre. Un nettoyage va s&#x27;imposer.</p>
<details class="details_IpIu alert alert--info details_jERq" data-collapsed="true"><summary>Cliquez ici pour un aperçu des données</summary><div><div class="collapsibleContent_Fd2D"><table><thead><tr><th style="text-align:left">idVoie</th><th style="text-align:left">uic8</th><th style="text-align:left">libGare</th><th style="text-align:left">libInfraVoie</th><th style="text-align:left">libCommVoie</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">B (CUZ&gt;GCO)</td><td style="text-align:left">B (CUZ&gt;GCO)</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">B (GCO&gt;CUZ)</td><td style="text-align:left">B (GCO&gt;CUZ)</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">A(CUZ&gt;GCO</td><td style="text-align:left">A (CUZ&gt;GCO)</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">1H</td><td style="text-align:left">1</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">G</td><td style="text-align:left">G</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">E (GCO&gt;CUZ)</td><td style="text-align:left">E (GCO&gt;CUZ)</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left"></td><td style="text-align:left">C (CUZ&gt;GCO)</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">C (GCO&gt;CUZ)</td><td style="text-align:left">C (GCO&gt;CUZ)</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left"></td><td style="text-align:left">A (GCO&gt;CUZ)</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">E (CUZ&gt;GCO)</td><td style="text-align:left">E (CUZ&gt;GCO)</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left">87745000</td><td style="text-align:left">Bellegarde (Ain)</td><td style="text-align:left">2H</td><td style="text-align:left">2</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">2(B)</td><td style="text-align:left">B(2)</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">1</td><td style="text-align:left">C(1)</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">2(B)</td><td style="text-align:left">B (2)</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">4(A)</td><td style="text-align:left">A(4)</td></tr><tr><td style="text-align:left">16</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">3</td><td style="text-align:left">D(3)</td></tr><tr><td style="text-align:left">17</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">3</td><td style="text-align:left">D(3)</td></tr><tr><td style="text-align:left">18</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">3</td><td style="text-align:left">D(3)</td></tr><tr><td style="text-align:left">19</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">1</td><td style="text-align:left">C(1)</td></tr><tr><td style="text-align:left">20</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">1</td><td style="text-align:left">C(1)</td></tr><tr><td style="text-align:left">21</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">4</td><td style="text-align:left">A</td></tr><tr><td style="text-align:left">22</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">2</td><td style="text-align:left">B</td></tr><tr><td style="text-align:left">23</td><td style="text-align:left">87584052</td><td style="text-align:left">Libourne</td><td style="text-align:left">2</td><td style="text-align:left">B</td></tr><tr><td style="text-align:left">24</td><td style="text-align:left">87741439</td><td style="text-align:left">Lépin-le-Lac</td><td style="text-align:left">D</td><td style="text-align:left">B (Direct)</td></tr><tr><td style="text-align:left">25</td><td style="text-align:left">87741439</td><td style="text-align:left">Lépin-le-Lac</td><td style="text-align:left">E</td><td style="text-align:left">A (Evi)</td></tr></tbody></table></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="données-de-lenvironnement-hastus">Données de l&#x27;environnement Hastus<a class="hash-link" aria-label="Lien direct vers Données de l&#x27;environnement Hastus" title="Lien direct vers Données de l&#x27;environnement Hastus" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#données-de-lenvironnement-hastus">​</a></h3>
<p>La plupart des attributs qui nous intéressent ici sont en réalité spécifiques à la version SNCF d&#x27;Hastus. Les attributs <code>Code Réseau</code>, <code>Code Immuable</code> et <code>Code Chantier</code> ont été créés pour stocker les codes UIC de la gare à laquelle correspond chaque lieu. Le code UIC8 disponible dans les données du système maison correspond donc aux deux derniers caractères du code réseau, accolés au code immuable.</p>
<p>Les attributs <code>Id Voie Agathe</code> et <code>Libellé Voie Agathe</code> donnent des indications sur le nom des voies, mais encore une fois, ne sont pas standardisés.</p>
<details class="details_IpIu alert alert--info details_jERq" data-collapsed="true"><summary>Cliquez ici pour un aperçu des données</summary><div><div class="collapsibleContent_Fd2D"><table><thead><tr><th style="text-align:left">plcIdentifier</th><th style="text-align:left">plcDescription</th><th style="text-align:left">plcCodeReseau</th><th style="text-align:left">plcCodeImmuable</th><th style="text-align:left">plcCodeChantier</th><th style="text-align:left">plcIdVoieAgathe</th><th style="text-align:left">plcLibelleVoieAgathe</th></tr></thead><tbody><tr><td style="text-align:left">LI1</td><td style="text-align:left">Libourne/BV - V1</td><td style="text-align:left">0087</td><td style="text-align:left">584052</td><td style="text-align:left">BV</td><td style="text-align:left">1</td><td style="text-align:left">V1</td></tr><tr><td style="text-align:left">LI2</td><td style="text-align:left">Libourne/BV - V2</td><td style="text-align:left">0087</td><td style="text-align:left">584052</td><td style="text-align:left">BV</td><td style="text-align:left">2</td><td style="text-align:left">V2</td></tr><tr><td style="text-align:left">LI3</td><td style="text-align:left">Libourne/BV - 3</td><td style="text-align:left">0087</td><td style="text-align:left">584052</td><td style="text-align:left">BV</td><td style="text-align:left">3</td><td style="text-align:left">3</td></tr><tr><td style="text-align:left">LI4</td><td style="text-align:left">Libourne/BV - 4</td><td style="text-align:left">0087</td><td style="text-align:left">584052</td><td style="text-align:left">BV</td><td style="text-align:left">4</td><td style="text-align:left">4</td></tr><tr><td style="text-align:left">LI5</td><td style="text-align:left">Libourne/BV - 5</td><td style="text-align:left">0087</td><td style="text-align:left">584052</td><td style="text-align:left">BV</td><td style="text-align:left">5</td><td style="text-align:left">5</td></tr><tr><td style="text-align:left">LPLd</td><td style="text-align:left">Lépin-le-Lac-La Bauche/00 - UNIQUE</td><td style="text-align:left">0087</td><td style="text-align:left">741439</td><td style="text-align:left">00</td><td style="text-align:left">UNIQUE</td><td style="text-align:left">D</td></tr><tr><td style="text-align:left">LPLe</td><td style="text-align:left">Lépin-le-Lac-La Bauche/00 - E</td><td style="text-align:left">0087</td><td style="text-align:left">741439</td><td style="text-align:left">00</td><td style="text-align:left">EVIT</td><td style="text-align:left">E</td></tr><tr><td style="text-align:left">BGD1</td><td style="text-align:left">Bellegarde (Ain)/BV - V1</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">V1</td><td style="text-align:left">V1</td></tr><tr><td style="text-align:left">BGD1h</td><td style="text-align:left">Bellegarde (Ain)/BV - V1H</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">V1H</td><td style="text-align:left">V1H</td></tr><tr><td style="text-align:left">BGD2h</td><td style="text-align:left">Bellegarde (Ain)/BV - V2H</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">V2H</td><td style="text-align:left">V2H</td></tr><tr><td style="text-align:left">BGD5</td><td style="text-align:left">Bellegarde (Ain)/BV - V5</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">V5</td><td style="text-align:left">V5</td></tr><tr><td style="text-align:left">BGDa</td><td style="text-align:left">Bellegarde (Ain)/BV - A</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">A</td><td style="text-align:left">A</td></tr><tr><td style="text-align:left">BGDb</td><td style="text-align:left">Bellegarde (Ain)/BV - B</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">B</td><td style="text-align:left">B</td></tr><tr><td style="text-align:left">BGDe-</td><td style="text-align:left">Bellegarde (Ain)/BV - VE-</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">VE-</td><td style="text-align:left">E</td></tr><tr><td style="text-align:left">BGDfi</td><td style="text-align:left">Bellegarde (Ain)/BV - FI</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">FI</td><td style="text-align:left">FI</td></tr><tr><td style="text-align:left">BGDg</td><td style="text-align:left">Bellegarde (Ain)/BV - V2</td><td style="text-align:left">0087</td><td style="text-align:left">745000</td><td style="text-align:left">BV</td><td style="text-align:left">V2</td><td style="text-align:left">VG</td></tr></tbody></table></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="principe-du-traitement">Principe du traitement<a class="hash-link" aria-label="Lien direct vers Principe du traitement" title="Lien direct vers Principe du traitement" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#principe-du-traitement">​</a></h2>
<p>Étant donné qu&#x27;une même voie peut exister sous plusieurs ID dans le système maison, mais pas dans Hastus, on va itérer sur les voies du système maison, et tenter de trouver pour chacune la meilleure voie Hastus possible. Plusieurs voies du système maison pourront donc être associées à la même voie Hastus. Mais certaines voies Hastus pourraient n&#x27;être associées à aucune voie du système maison. Dans notre cas, les <em>cibles</em> sont donc les voies du système maison et les <em>candidats</em> sont les lieux Hastus.</p>
<div class="theme-admonition theme-admonition-note admonition_WCGJ alert alert--secondary"><div class="admonitionHeading_GCBg"><span class="admonitionIcon_L39b"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>remarque</div><div class="admonitionContent_pbrs"><p><code>findBestMatchForTargetAmongCandidates</code>, comme son nom l&#x27;indique, trouve une
correspondance pour <strong>une <em>cible</em></strong> parmi <strong>plusieurs <em>candidats</em></strong> et n&#x27;est
pas approprié pour les cas où on souhaite des correspondances strictes <em>un
pour un</em> entre deux listes. Il faut alors utiliser d&#x27;autres services, comme
<code>matchTwoListsOfString</code>, ou utiliser <code>findBestMatchForTargetAmongCandidates</code>
mais ajouter de la logique autour pour retirer les candidats de la liste à
mesure qu&#x27;ils sont associés aux cibles.</p></div></div>
<p>Pour une <em>cible</em> donnée, la liste de <em>candidats</em> sera constituée des lieux Hastus qui ont le même code UIC8 que la cible. Dans cette liste de candidat, on va alors essayer d&#x27;en trouver un qui a le même <em>nom de voie</em> que la cible. Mais comme on l&#x27;a vu précédemment, le <em>nom de voie</em> n&#x27;est pas standard, et dans beaucoup de cas, les noms de voies devront être nettoyés si on veut qu&#x27;ils correspondent entre eux.</p>
<p>C&#x27;est ici que le mécanisme itératif de <code>findBestMatchForTargetAmongCandidates</code> sera utile.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="concepts-de-findbestmatchfortargetamongcandidates">Concepts de <code>findBestMatchForTargetAmongCandidates</code><a class="hash-link" aria-label="Lien direct vers concepts-de-findbestmatchfortargetamongcandidates" title="Lien direct vers concepts-de-findbestmatchfortargetamongcandidates" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#concepts-de-findbestmatchfortargetamongcandidates">​</a></h2>
<p>Ci-dessous, un résumé du README de <code>findBestMatchForTargetAmongCandidates</code> (auquel vous devriez vous référer pour plus de détails) avec la traduction des concepts pour notre cas précis.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="principe-de-fonctionnement">Principe de fonctionnement<a class="hash-link" aria-label="Lien direct vers Principe de fonctionnement" title="Lien direct vers Principe de fonctionnement" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#principe-de-fonctionnement">​</a></h3>
<p>On essaie en plusieurs itérations de trouver la meilleure correspondance pour une <em>cible</em> parmi plusieurs <em>candidats</em>.</p>
<p>À chaque itération, on passe par deux phases:</p>
<ol>
<li>Réduire la liste de candiats</li>
<li>Calculer une <em>distance</em> entre la <em>cible</em> et chaque <em>candidat</em>, et déclarer un <em>bestMatch</em> si les <em>critères</em> sont atteints</li>
</ol>
<p>Ces principes donnent beaucoup de flexibilité et permettent d&#x27;ajuster rapidement et facilement les critères afin d&#x27;optimiser la performance et la qualité des correspondances. Par exemple:</p>
<ul>
<li>on défini une première itération très stricte, qui cible une liste réduite de candidats, avec un calcul de distance simple pour abattre rapidement une grosse partie du travail</li>
<li>dans les itérations suivantes, on peut se permettre de cibler plus de candidats et d&#x27;avoir des critères plus complexes, car on sait qu&#x27;elle ne seront exécutées que sur les quelques cibles restantes</li>
<li>si ça n&#x27;a toujours pas suffi, on peut faire des tentatives carrément loufoques dans les dernières itérations, quitte à traiter avec un grain de sel les résultats obtenus dans celles-ci</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="target-et-candidates"><code>target</code> et <code>candidates</code><a class="hash-link" aria-label="Lien direct vers target-et-candidates" title="Lien direct vers target-et-candidates" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#target-et-candidates">​</a></h3>
<p>La <code>target</code> ou <em>cible</em> est l&#x27;objet pour lequel on recherche une correspondance parmi plusieurs <code>candidates</code> ou <em>candidats</em>.</p>
<p>Dans notre cas, la <em>cible</em> sera une voie du système maison et les <em>candidats</em> seront les lieux Hastus.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="phase-1--réduire-la-liste-de-candidats">Phase 1 : Réduire la liste de candidats<a class="hash-link" aria-label="Lien direct vers Phase 1 : Réduire la liste de candidats" title="Lien direct vers Phase 1 : Réduire la liste de candidats" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-1--réduire-la-liste-de-candidats">​</a></h3>
<p>Les options pour cette phase sont définies sous la clé <code>candidatesFilteringConfig</code> de la configuration globale.
Si cette clé n&#x27;est pas définie, tous les candidats sont utilisés. Si la clef est définie, les candidats sont filtrés dans deux sous-phases.</p>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="phase-1a-filterpredicate">Phase 1A: filterPredicate<a class="hash-link" aria-label="Lien direct vers Phase 1A: filterPredicate" title="Lien direct vers Phase 1A: filterPredicate" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-1a-filterpredicate">​</a></h4>
<p>Cette phase est utile pour éliminer des candidats sur la base de critères fixes, qui ne varient pas en fonction de la cible.</p>
<p>Elle n&#x27;est pas utilisée dans notre cas car nos filtres fixes sont les mêmes pour toutes les itérations, donc nous les appliquons une fois pour toute dans le script avant même de rentrer dans <code>findBestMatchForTargetAmongCandidates</code></p>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id="phase-1b-regrouper-les-candidats-et-conserver-le-groupe-qui-correspond-à-une-clef-calculée-sur-la-cible">Phase 1B: regrouper les candidats et conserver le groupe qui correspond à une clef calculée sur la cible<a class="hash-link" aria-label="Lien direct vers Phase 1B: regrouper les candidats et conserver le groupe qui correspond à une clef calculée sur la cible" title="Lien direct vers Phase 1B: regrouper les candidats et conserver le groupe qui correspond à une clef calculée sur la cible" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-1b-regrouper-les-candidats-et-conserver-le-groupe-qui-correspond-à-une-clef-calculée-sur-la-cible">​</a></h4>
<p>Cette phase permet de ne conserver que les candidats qui ont une caractéristique commune avec la cible.</p>
<p>D&#x27;abord, on regroupe tous les candidats sur la base de cette caractéristique. Ensuite, on calcule (si nécessaire) la valeur de cette caractéristique pour la cible, et on ne conserve que les candidats qui ont la même valeur que la cible.</p>
<p>Dans notre cas, la caractéristique commune qui nous intéresse est le code UIC8. On va regrouper les lieux Hastus par code UIC8 et ne considérer que ceux qui ont le même que la voie maison.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id="phase-2--trouver-le-meilleur-candidat-parmi-ceux-qui-restent">Phase 2 : trouver le meilleur candidat parmi ceux qui restent<a class="hash-link" aria-label="Lien direct vers Phase 2 : trouver le meilleur candidat parmi ceux qui restent" title="Lien direct vers Phase 2 : trouver le meilleur candidat parmi ceux qui restent" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-2--trouver-le-meilleur-candidat-parmi-ceux-qui-restent">​</a></h3>
<p>Les options pour cette phase sont définies sous la clé <code>getBestMatchConfig</code> de la configuration globale. Plusieurs options de configuration existent, mais les deux plus importantes sont <code>distanceFunction</code> et <code>maxDistance</code></p>
<p><code>distanceFunction</code> est une fonction qui doit calculer une <em>distance</em> entre la cible et le candidat. Pour un candidat qui correspond parfaitement à la cible, <code>distanceFunction</code> devrait renvoyer <code>0</code>. Moins le candidat correspond à la cible, plus la valeur renvoyée par <code>distanceFunction</code> devrait être grande.</p>
<p>Si aucun des candidats n&#x27;a une valeur de <code>0</code>, alors c&#x27;est le candidat qui a la plus petite valeur qui est considéré comme la meilleure correspondance, à condition que cette valeur soit inférieure à la valeur définie dans <code>maxDistance</code></p>
<p>Dans notre cas, on ne va pas utiliser ce mécanisme à son plein potentiel. Notre <code>distanceFunction</code> va simplement comparer les libellés de voie, après les avoir plus ou moins nettoyés. Si elle trouve une correspondance exacte entre libellés de voies nettoyés, elle va renvoyer <code>0</code>. Sinon, elle va renvoyer +infini, et il faudra passer au candidat suivant, puis à l&#x27;itération suivante le cas échéant.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="étapes-de-nettoyage">Étapes de nettoyage<a class="hash-link" aria-label="Lien direct vers Étapes de nettoyage" title="Lien direct vers Étapes de nettoyage" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#étapes-de-nettoyage">​</a></h2>
<p>À chaque itération, on fait les 4 comparaisons possibles:</p>
<ul>
<li>Libellé Infra vs Id Voie</li>
<li>Libellé Commercial vs Id voie</li>
<li>Libellé Infra vs Libellé Voie</li>
<li>Libellé Commercial vs Libellé Voie</li>
</ul>
<p>On considère qu&#x27;un lieu Hastus correspond à la voie maison dès que les valeurs sont les mêmes pour une des comparaison.</p>
<p>À chaque fois, on applique des &quot;nettoyages&quot; aux valeurs de la cible et des candidats avant de les comparer.</p>
<p>À chaque itération, on ajoute des &quot;nettoyages&quot; en plus de ceux faits aux itérations précédentes. Par exemple:</p>
<ol>
<li>mettre tout en minuscules</li>
<li>retirer les &quot;V&quot; ou &quot;v&quot; au début des libellés</li>
<li>retirer tout texte entre parenthèses</li>
<li>transformer UNIQUE en U, BIS en B, TER en T</li>
<li>retirer les espaces au milieu des libellés</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="mise-en-oeuvre">Mise en oeuvre<a class="hash-link" aria-label="Lien direct vers Mise en oeuvre" title="Lien direct vers Mise en oeuvre" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#mise-en-oeuvre">​</a></h2>
<p>Ci-dessous, un aperçu commenté de la fonction qui utilise <code>findBestMatchForTargetAmongCandidates</code> dans le script.</p>
<div class="language-javascript codeBlockContainer_mQmQ theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_x_ju">getBestMatchResultByExternalTrack.js</div><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-javascript codeBlock_RMoD thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Les utilitaires ci-dessous seront brièvement décrits quand ils seront</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> * utilisés dans le code */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> findBestMatch </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-utils-find-best-match-for-target-among-candidates&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  cleanStringUsingRegexAndReplacePairs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-utils-string&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> matchTwoListsOfStrings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-utils-match-two-lists-of-strings&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> countBy </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;lodash&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Cette fonction est appellée par le script, qui s&#x27;est chargé par ailleurs</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> * - de charger les voies maisons et d&#x27;en faire un array d&#x27;objets</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> *   (externalTracks)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> * - de charger et pré-filtrer le jeu de lieux Hastus (placesCollection)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">getBestMatchResultByExternalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token parameter">externalTracks</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token parameter">  placesCollection</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token parameter">  logger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Dans notre cas, on va filtrer les lieux de la même manière pour toutes les</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * itérations. On définit donc une seule fois candidatesFilteringConfig</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * Mais gardez en tête qu&#x27;on peut parfaitement le faire varier à chaque</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * itération quand c&#x27;est utile.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> candidatesFilteringConfig </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** La target est la voie maison, qui possède directement une clé &#x27;uic8&#x27; */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token literal-property property">getKeyFromTargetConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;uic8&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Il n&#x27;y a pas directement de clé équivalent sur les lieux Hastus,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">     * on la fabrique à la volée avec la fonction ci-dessous */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">groupCandidatesByConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">place</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">place</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token template-string interpolation property-access">plcCodeReseau</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token template-string interpolation method function property-access" style="color:rgb(220, 220, 170)">substr</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string interpolation operator" style="color:rgb(212, 212, 212)">-</span><span class="token template-string interpolation number" style="color:rgb(181, 206, 168)">2</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">place</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token template-string interpolation property-access">plcCodeImmuable</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** La &quot;distanceFunction&quot; varie à chaque itération, mais elle a toujours la</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * même forme. On va donc créer une &quot;distanceFunctionFactory&quot;: une fonction</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * qui retourne une fonction.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * À chaque itération, on va appeler la factory en lui passant des</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * regexAndReplacePairs plus ou moins complexes pour transformer les strings.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * On obtiendra alors une &quot;distanceFunction&quot; classique qui transforme les</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * strings, puis les compare, et retourne 0 s&#x27;il y a un match, +infini sinon.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">regexAndReplacePairs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">externalTrackPlace</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> hastusPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Pour simplifier les manipulations, on regroupe les strings qui nous intéressent */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> rawExternalStrings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        externalTrackPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">libInfraVoie</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        externalTrackPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">libCommVoie</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> rawHastusStrings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        hastusPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">plcIdVoieAgathe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        hastusPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">plcLibelleVoieAgathe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** cleanStringUsingRegexAndReplacePairs applique successivement des</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">       * expressions régulières à une string pour la nettoyer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> cleanExternalStrings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> rawExternalStrings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">cleanStringUsingRegexAndReplacePairs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          regexAndReplacePairs</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> cleanHastusStrings </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> rawHastusStrings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">cleanStringUsingRegexAndReplacePairs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          regexAndReplacePairs</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">toLowerCase</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** En l&#x27;utilisant avec l&#x27;option </span><span class="token doc-comment comment punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"> returnOnFirstMatch: true </span><span class="token doc-comment comment punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">       * matchTwoListsOfStrings permet de savoir rapidement s&#x27;il y a une</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">       * correspondance exacte entre n&#x27;importe quelles 2 strings de deux</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">       * listes  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> matched </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">matchTwoListsOfStrings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">cleanExternalStrings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cleanHastusStrings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token literal-property property">returnOnFirstMatch</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> matched</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token constant" style="color:rgb(100, 102, 149)">POSITIVE_INFINITY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/**On stockera les résultats dans cette variable */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> bestMatchResultByExternalTrack </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Les regexAndReplacePairs ci-dessous vont permettre de nettoyer les</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * strings. Si besoin de plus de détails sur le fonctionnement des</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * regex, n&#x27;hésitez pas à laisser un commentaire sous cet article */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> removeVRegexAndReplacePair </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/^[vV](.+)$/&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> removeParenthesisRegexAndReplacePair </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/(\\w+).*(\\(.+\\))/gim&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;$1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> transformUniqueIntoU </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/^UNIQUE$/i&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;U&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> transformBisIntoB </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/BIS/i&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;B&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> transformTerIntoT </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/TER/i&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;T&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> removeSpaces </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/ /g&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  externalTracks</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">forEach</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">externalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Noter que findBestMatch... accepte les candidates sous la forme d&#x27;un</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">     * array ou d&#x27;une collection. La collection est préférable car permet de</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">     * profiter du cache pour améliorer la performance */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> bestMatchResult </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">findBestMatch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token literal-property property">target</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> externalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token literal-property property">candidates</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> placesCollection </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token literal-property property">iterationConfigs</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">iterationName</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1 = tout mettre en minuscule&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            candidatesFilteringConfig </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** Voir ligne 25 */</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">getBestMatchConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">detailedResults</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">distanceFunction</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/**Aucun nettoyage particulier pour cette itération */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">maxDistance</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">iterationName</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2 = 1 + retrait des &quot;V&quot; ou &quot;v&quot; au début des noms de voies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            candidatesFilteringConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">getBestMatchConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">detailedResults</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">distanceFunction</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeVRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">maxDistance</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">iterationName</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3 = 2 + retrait du texte entre parenthèses&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            candidatesFilteringConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">getBestMatchConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">detailedResults</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">distanceFunction</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeVRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeParenthesisRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">maxDistance</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">iterationName</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4 = 3 + transfo UNIQUE &gt; U, BIS &gt; B, TER &gt; T&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            candidatesFilteringConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">getBestMatchConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">detailedResults</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">distanceFunction</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeVRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeParenthesisRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformUniqueIntoU</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformBisIntoB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformTerIntoT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">maxDistance</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">iterationName</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;5 = 4 + retrait des espaces&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            candidatesFilteringConfig</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token literal-property property">getBestMatchConfig</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">detailedResults</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">distanceFunction</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">distanceFunctionFactory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeVRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeParenthesisRegexAndReplacePair</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformUniqueIntoU</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformBisIntoB</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                transformTerIntoT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                removeSpaces</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token literal-property property">maxDistance</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    bestMatchResultByExternalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">externalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bestMatchResult</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">/** on laisse ce petit exemple de rapport minimaliste pour montrer que les</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token doc-comment comment" style="color:rgb(106, 153, 85)">   * résultats incluent des infos sur l&#x27;itération qui a produit le match */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> numberOfMatchesByIteration </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">countBy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">bestMatchResultByExternalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">values</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;indexOfIterationThatMatched&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">info</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">JSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">stringify</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">numberOfMatchesByIteration</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> bestMatchResultByExternalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">module</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> getBestMatchResultByExternalTrack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id="conclusion">Conclusion<a class="hash-link" aria-label="Lien direct vers Conclusion" title="Lien direct vers Conclusion" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#conclusion">​</a></h2>
<p>Même si cet exemple ne tire pas profit de toute la puissance de <code>findBestMatchForTargetAmongCandidates</code> il illustre bien <em>l&#x27;expressivité</em> rendue possible grâce au système des itérations.</p>
<p>En quelques dizaines de lignes de code, on met en place une structure qui permet ensuite de s&#x27;amuser facilement avec les données, en ajoutant simplement de nouvelles itérations, mais en conservant beaucoup de puissance et de flexibilité.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags :</b><ul class="tags_Ow0B padding--none margin-left--sm"><li class="tag_DFxh"><a class="tag_otG2 tagRegular_s0E1" href="/examples/tags/find-best-match-for-target-among-candidates">findBestMatchForTargetAmongCandidates</a></li><li class="tag_DFxh"><a class="tag_otG2 tagRegular_s0E1" href="/examples/tags/lieux">lieux</a></li></ul></div></div></footer></article><div><hr></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des articles du blog"><a class="pagination-nav__link pagination-nav__link--next" href="/examples/creation-du-service-get-bbox-for-place"><div class="pagination-nav__sublabel">Article plus ancien</div><div class="pagination-nav__label">Créer un nouveau service Bimo</div></a></nav></main><div class="col col--2"><div class="tableOfContents_XG6w thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#problème">Problème</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#aperçu-des-données">Aperçu des données</a><ul><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#données-du-système-maison">Données du système maison</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#données-de-lenvironnement-hastus">Données de l&#39;environnement Hastus</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#principe-du-traitement">Principe du traitement</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#concepts-de-findbestmatchfortargetamongcandidates">Concepts de <code>findBestMatchForTargetAmongCandidates</code></a><ul><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#principe-de-fonctionnement">Principe de fonctionnement</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#target-et-candidates"><code>target</code> et <code>candidates</code></a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-1--réduire-la-liste-de-candidats">Phase 1 : Réduire la liste de candidats</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#phase-2--trouver-le-meilleur-candidat-parmi-ceux-qui-restent">Phase 2 : trouver le meilleur candidat parmi ceux qui restent</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#étapes-de-nettoyage">Étapes de nettoyage</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#mise-en-oeuvre">Mise en oeuvre</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates#conclusion">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/blog">Blog</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/examples">Exemples</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/intro">Documentation</a><span class="footer__link-separator">·</span><a href="https://github.com/bimodata/bimo" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Gaël Haméon</div></div></div></footer></div>
</body>
</html>