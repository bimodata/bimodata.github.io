<!doctype html>
<html lang="fr" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-examples" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus | Bimo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://bimodata.github.io/img/bimo-social-card-fr.jpg"><meta data-rh="true" name="twitter:image" content="https://bimodata.github.io/img/bimo-social-card-fr.jpg"><meta data-rh="true" property="og:url" content="https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus | Bimo"><meta data-rh="true" name="description" content="Origine du besoin"><meta data-rh="true" property="og:description" content="Origine du besoin"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-11-27T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/gaelhameon"><meta data-rh="true" property="article:tag" content="hastus,cartographie,geo,mapshaper,lieux"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus" hreflang="fr"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/en/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus" hreflang="en"><link data-rh="true" rel="alternate" href="https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus","mainEntityOfPage":"https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus","url":"https://bimodata.github.io/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus","headline":"Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus","name":"Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus","description":"Origine du besoin","datePublished":"2022-11-27T00:00:00.000Z","author":{"@type":"Person","name":"Gaël Haméon","description":"Créateur de Bimo","url":"https://github.com/gaelhameon","image":"https://github.com/gaelhameon.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://bimodata.github.io/examples","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Bimo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Bimo Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/examples/rss.xml" title="Bimo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/examples/atom.xml" title="Bimo Atom Feed"><link rel="stylesheet" href="/assets/css/styles.c1b6f800.css">
<script src="/assets/js/runtime~main.cd1af7c6.js" defer="defer"></script>
<script src="/assets/js/main.76753056.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/bimo-dark-blue.png" alt="Logo Bimo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/bimo-light-blue.png" alt="Logo Bimo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Bimo</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/examples">Exemples</a><a class="navbar__item navbar__link" href="/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Français</a><ul class="dropdown__menu"><li><a href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">Français</a></li><li><a href="/en/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="mailto:gael.hameon@gmail.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/bimodata/bimo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Navigation article de blog récent"><div class="sidebarItemTitle_pO2u margin-bottom--md">Tous nos exemples</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates">Réconcilier les lieux de deux systèmes différents</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/examples/creation-du-service-get-bbox-for-place">Créer un nouveau service Bimo</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus">Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Extraire automatiquement des images de plans de voies à partir de la cartographie Hastus</h1><div class="container_iJTo margin-vert--md"></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/gaelhameon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/gaelhameon.png" alt="Gaël Haméon"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/gaelhameon" target="_blank" rel="noopener noreferrer"><span>Gaël Haméon</span></a></div><small class="avatar__subtitle">Créateur de Bimo</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="origine-du-besoin">Origine du besoin<a class="hash-link" aria-label="Lien direct vers Origine du besoin" title="Lien direct vers Origine du besoin" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#origine-du-besoin">​</a></h2>
<p>On a:</p>
<ul>
<li>
<p>d&#x27;une part, un environnement Hastus dans lequel l&#x27;ensemble du Réseau Ferré National français est cartographié dans le module Geo, et ou chaque voie à quai d&#x27;une gare commerciale est modélisée par un lieu</p>
</li>
<li>
<p>d&#x27;autre part, un outil SNCF maison où des informations importantes sur les voies à quai ont été saisies manuellement</p>
</li>
</ul>
<p>On souhaite établir une équivalence entre les référentiels de voies à quai de ces deux systèmes afin de pouvoir importer dans Hastus les informations saisies dans le système maison.</p>
<p>Un <a href="/examples/réconcilier-les-lieux-de-deux-systèmes-différents-avec-find-best-match-for-target-among-candidates">autre article</a> décrira éventuellement comment des services Bimo ont été utilisés pour initialiser ce travail, mais cela restera néanmoins toujours une initialisation : dans certains cas, on n&#x27;arrive pas à faire le rapprochement entre les voies automatiquement, et il faut demander à un humain d&#x27;intervenir.</p>
<p>Afin de faciliter cette intervention, on souhaite mettre à disposition des humains en question une IHM qui affichera, pour une gare donnée:</p>
<ul>
<li>la liste des voies disponibles dans le système SNCF maison</li>
<li>la liste des voies disponibles dans Hastus</li>
<li>les équivalences trouvées automatiquement par les algos</li>
<li>une image du plan de voie de la gare dans Hastus, et de la position des voies Hastus sur ce plan de voie</li>
</ul>
<p>En effet, il existe souvent plusieurs &quot;alias&quot; pour une même voie, et le nom de voie utilisé dans Hastus n&#x27;est pas toujours celui avec lequel les utilisateurs sont le plus familier. En leur montrant à quelle voie correspond un nom sur le plan de voie, on facilite grandement le travail. On aurait pu aussi se contenter de dire aux utilisateurs d&#x27;ouvrir la carte Hastus, et de trouver dans la carte la gare concernée à chaque fois. Mais cela aurait ajouté des manipulations et du temps à une tâche déjà pas très amusante ... et mon rôle sur ce projet est précisément de m&#x27;amuser à automatiser et accélérer des manipulations pas très amusantes pour des humains.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exploration-des-solutions">Exploration des solutions<a class="hash-link" aria-label="Lien direct vers Exploration des solutions" title="Lien direct vers Exploration des solutions" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#exploration-des-solutions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="processus-global">Processus global<a class="hash-link" aria-label="Lien direct vers Processus global" title="Lien direct vers Processus global" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#processus-global">​</a></h3>
<p>Pour ne pas réinventer la roue, on considère que l&#x27;IHM qui sera présentée aux utilisateurs sera un fichier Excel par région, contenant un onglet pour chaque gare de la région. Sur cet onglet, on voudrait afficher le plan de voie, les listes de voies, et prévoir un endroit où les utilisateurs pourront confirmer/corriger la correspondance.
Ces fichiers pourront ensuite être relus automatiquement pour en extraire les correspondances validées.</p>
<p>On souhaite donc produire des images de plan de voie à partir de la carte Hastus, dans un format qui pourra être incorporé dans un fichier Excel.</p>
<p>Les fonctionnalités standard Hastus permettent d&#x27;extraire la carte en format Shapefile et on connaît un très bon outil open source pour manipuler des fichiers Shapefile: <a href="https://mapshaper.org" target="_blank" rel="noopener noreferrer">mapshaper</a></p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Note sur la sécurité des données</summary><div><div class="collapsibleContent_i85q"><p>Pour ceux qui s&#x27;inquiéteraient de l&#x27;utilisation d&#x27;outils internet grand public pour la manipulation de données potentiellement sensibles, sachez que mapshaper traite toutes les données côté client - jamais nos données ne quittent notre poste. Et si cela ne suffisait pas, j&#x27;incorpore dans certaines distributions Bimo un &quot;fork&quot; de mapshaper qui pourrait vous rassurer encore plus: après avoir téléchargé Bimo, vous pouvez couper toute connexion internet, lancer Bimo et avoir une instance mapshaper qui tourne.</p></div></div></details>
<p>Une vérification rapide montre que mapshaper permet d&#x27;exporter une carte au format <code>svg</code> et qu&#x27;Excel permet d&#x27;incorporer des images dans ce format.</p>
<p>On va donc utiliser mapshaper pour produire des <code>svg</code> de toutes les gares, puis on pourra incorporer ces svg dans les fichiers Excel.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="commandes-mapshaper">Commandes mapshaper<a class="hash-link" aria-label="Lien direct vers Commandes mapshaper" title="Lien direct vers Commandes mapshaper" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#commandes-mapshaper">​</a></h3>
<p>Mapshaper peut être utilisé via l&#x27;IHM web, mais fourni aussi un CLI node, déjà incorporé dans le backend Bimo. Mais en plus, l&#x27;IHM web permet d&#x27;utiliser une console pour tester des commandes.</p>
<p><img decoding="async" loading="lazy" alt="Manipulations pour afficher la console dans l&amp;#39;IHM Mapshaper" src="/assets/images/mapshaper-console-5222092c093209dc92084c559f528636.gif" width="1916" height="1025" class="img_ev3q"></p>
<p>L&#x27;aide est disponible directement dans la console, ou sur le repo Github du projet.</p>
<p>On y trouve la commande <a href="https://github.com/mbloch/mapshaper/wiki/Command-Reference#-clip" target="_blank" rel="noopener noreferrer">clip</a>, qui va permettre de produire un nouveau calque à partir d&#x27;un calque existant, en conservant uniquement une zone délimitée par des coordonnées ou par une géométrie présente sur un autre calque.</p>
<p>En testant un peu, on conclut que la commande ci-dessous semble donner satisfaction. Notez bien l&#x27;utilisation du &quot;+&quot; qui indique de créer un nouveau calque, et donc de préserver le calque cible tel qu&#x27;il était. L&#x27;argument &quot;name&quot; donne le nom du nouveau calque.</p>
<p><code>clip target=calque_initial bbox=xmin,ymin,xmax,ymax + name=clip_de_gare_1</code></p>
<p><img decoding="async" loading="lazy" alt="Exemple d&amp;#39;application de la commande clip" src="/assets/images/commande-clip-a20f59b23ddc710b0aebca5683f5ab24.gif" width="1916" height="1025" class="img_ev3q"></p>
<p>Ça marche très bien pour extraire la géométrie des voies à partir du mapshaper extrait d&#x27;Hastus. Par contre les lieux-voies n&#x27;apparaissent pas ... En effet, dans Hastus, les lieux sont des objets à part, qui sont associés à des segments de la carte, mais n&#x27;en font pas partie.</p>
<p>On devra donc obtenir un autre fichier contenant les données sur les lieux, et l&#x27;importer en tant que calque supplémentaire dans Mapshaper (ceci pourrait faire l&#x27;objet d&#x27;un autre article si ça intéresse quelqu&#x27;un !).</p>
<p>À ce stade, on arrive à produire une image dans laquelle on a les voies, ainsi que des points correspondant aux lieux. Mais il manque toujours les libellés.</p>
<p>On va donc utiliser la commande <code>style</code> de mapshaper pour les faire apparaître.</p>
<p><code>style target=calque_des_lieux&quot; label-text=&#x27;plcIdentifier&#x27; dx=5 dy=5 ...</code></p>
<p><img decoding="async" loading="lazy" alt="Résultat avec des libellés" src="/assets/images/test-avec-libelles-178d8bb33becb68cf4d14844f4ac5853.png" width="1920" height="1040" class="img_ev3q"></p>
<p>Ça commence à ressembler pas mal à ce qu&#x27;on souhaite ! On va donc se lancer dans l&#x27;automatisation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="automatisation">Automatisation<a class="hash-link" aria-label="Lien direct vers Automatisation" title="Lien direct vers Automatisation" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#automatisation"> ​</a></h2>
<p>On veut générer une image pour chaque gare et on souhaite que cette image englobe toutes les voies de la gare. Dans Hastus, on peut considérer qu&#x27;une gare est à peu près équivalente à &quot;lieu de référence&quot;, qui n&#x27;existe pas sur la carte, mais qui est associé à plusieurs &quot;lieux-voies&quot;, qui ont eux des coordonnées.</p>
<p>On va donc:</p>
<ul>
<li>itérer sur tous les lieux de référence<!-- -->
<ul>
<li>pour chaque lieu de référence, récupérer tout ses lieux-voies<!-- -->
<ul>
<li>à partir des coordonnées de tous les lieux-voies, calculer les coordonnées d&#x27;une &quot;Bounding Box&quot;</li>
<li>prendre un clip des calques &quot;voies&quot; et &quot;lieux-voies&quot; avec cette bbox</li>
<li>gérer le style du clip pour ajouter les libellés</li>
<li>exporter le clip au format SVG, avec un nom de fichier correspondant à l&#x27;identifiant de la gare</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>On n&#x27;est pas sur un sujet récurrent ici, et on n&#x27;a pas vraiment besoin que ce travail puisse être fait facilement par n&#x27;importe quel utilisateur. On va donc tout simplement créer un nouveau &quot;script&quot; dans Bimo, qui ne pourra être exécuté que par les utilisateurs qui ont accès au code source, et qui s&#x27;appuiera sur les services et utilitaires Bimo existants, notamment:</p>
<ul>
<li><code>const { getEntityFromOirDataAtPath } = require(&#x27;@bimo-test/utils-get-test-data&#x27;);</code> va permettre de charger facilement un jeu de lieux, puis d&#x27;itérer sur les lieux de référence, obtenir leurs lieux-voies et leurs coordonnées</li>
<li><code>const { api: mapshaper } = require(&#x27;@bimo/mapshaper&#x27;);</code> va permettre d&#x27;intégrer des commandes mapshaper dans notre script</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-service-getbboxforplace">Création du service <code>getBboxForPlace</code><a class="hash-link" aria-label="Lien direct vers création-du-service-getbboxforplace" title="Lien direct vers création-du-service-getbboxforplace" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#création-du-service-getbboxforplace">​</a></h3>
<p>Le sujet du calcul d&#x27;une Bbox pour un lieu est nouveau. Il est assez simple à première vue, mais:</p>
<ul>
<li>c&#x27;est exactement le genre de code dans lequel il est très facile d&#x27;introduire des bugs par de mauvais copier/coller ou autre</li>
<li>ce thème peut en réalité être assez complexe:<!-- -->
<ul>
<li>quelles marges ajouter autour des coordonnées des lieux voies ?</li>
<li>pourrions-nous (pour d&#x27;autres usages) vouloir passer directement un lieu voie, et avoir une bbox centrée autour de celui-ci ?</li>
<li>et si on voulait un jour une bbox d&#x27;une autre forme ? Un cercle, ou un rectangle orienté à 45 degrés</li>
</ul>
</li>
</ul>
<p>On va donc créer un nouveau service Bimo, avec des tests unitaires, pour ce sujet. Cela peut sembler être une perte de temps à court terme, mais devrait nous en faire gagner à long terme.</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-script-generate-station-svg">Création du script <code>generate-station-svg</code><a class="hash-link" aria-label="Lien direct vers création-du-script-generate-station-svg" title="Lien direct vers création-du-script-generate-station-svg" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#création-du-script-generate-station-svg">​</a></h3>
<p>On a maintenant tous les services de base dont on a besoin pour notre script, dont vous trouverez ci-dessous une version simplifiée et commentée du code final.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">script.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> path </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;path&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> fsBimo </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-utils-filesystem&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Un package qui nous aide à interagir avec le système de fichier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token literal-property property">api</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> mapshaper </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/mapshaper&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// La fork &quot;bimo&quot; de mapshaper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  getEntityFromOirDataAtPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/test-utils-get-test-data&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Une fonction pour simplifier le chargement de données oig/oir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> getBboxForPlace </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-services-get-bbox-for-place&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// le script qu&#x27;on a écrit à l&#x27;étape précédente!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> featureCollection </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@turf/helpers&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// un package externe qui aide à manipuler des geojson</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> createGeojsonFeatureFromPlace </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-services-create-geojson-feature-from-place&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// un package interne qui aide à créer des geojson à partir de lieux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> </span><span class="token maybe-class-name">PlacesCollection</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">require</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@bimo/core-entities&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// La classe qui définit un jeu de lieux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PATH_TO_PLACES_COLLECTION_FOLDER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  __dirname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;input&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;places-collection&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// On définit un dossier d&#x27;entrée dans lequel l&#x27;utilisateur devra déposer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// une extraction des lieux d&#x27;un environnement Hastus, et le fichier OIR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// qui décrit le format de l&#x27;extraction...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PATH_TO_TRACKS_MAP</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  __dirname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;input&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tracks-map&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tracks.geojson&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// ... et un fichier correspondant à une carte des voies (obtenue soit depuis Hastus, ou une autre source)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PATH_TO_FULL_PLACES_COLLECTION_MAP</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  __dirname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;output&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;places-map&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;places.geojson&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// c&#x27;est ici que le script déposera la carte des lieux produite à partir du jeu de lieux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> startTime </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Date</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// pour mesurer le temps écoulé à la fin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Étape 1: on va créer une carte représentant tous les lieux voies et</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// l&#x27;exporter à un endroit où mapshaper pourra ensuite aller la charger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> placesCollection </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">getEntityFromOirDataAtPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PATH_TO_PLACES_COLLECTION_FOLDER</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token maybe-class-name">OscarPlacesCollection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> fsBimo</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">outputJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token constant" style="color:rgb(100, 102, 149)">PATH_TO_FULL_PLACES_COLLECTION_MAP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">createPlacesFeatureCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">placesCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// voir à la fin du script pour la définition de createPlacesFeatureCollection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Étape 2: on va maintenant fabriquer les commandes que l&#x27;on va soumettre</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// à mapshaper</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> commandLines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-i </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation constant" style="color:rgb(100, 102, 149)">PATH_TO_FULL_PLACES_COLLECTION_MAP</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)"> name=places</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-i </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation constant" style="color:rgb(100, 102, 149)">PATH_TO_TRACKS_MAP</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)"> name=tracks</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-style target=places r=4 label-text=&#x27;plcIdentifier&#x27; text-anchor=start dx=10 dy=10 fill=red</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// on commence par charger la carte des lieux et la carte des voies, et on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// applique un style global à la carte des lieux:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// on va afficher un cercle de rayon 4 sur chaque lieu, avec à côté un</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// libellé contenant le &quot;plcIdentifier&quot;, décalé de 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// par rapport au point, et affiché en rouge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  placesCollection</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">placesByReferencePlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">forEach</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">places</span><span class="token parameter punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token parameter"> referencePlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// On parcourt tous les PR du jeu de lieux, et pour chacun:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> plcIdentifier </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> referencePlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> pathToOutput </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        __dirname</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;output&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;svgs&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">plcIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">.svg</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// on va produire un fichier nommé selon l&#x27;ID de lieu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> bBoxString </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">getBboxForPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">referencePlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">getMapshaperStyleString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">// on calcule la &quot;Bounding Box&quot; qui englobe tous les lieux voies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      commandLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">push</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-clip target=places bbox=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">bBoxString</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)"> + name=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">plcIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">_1</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-clip target=tracks bbox=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">bBoxString</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)"> + name=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">plcIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">_2</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// on prend des clips des deux cartes, aux mesures de la bounding box</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">-o target=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">plcIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">_1,</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">plcIdentifier</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">_2 </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">pathToOutput</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// on exporte ces clips sous forme de .svg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string svg language-svg">-drop target=</span><span class="token template-string svg language-svg interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string svg language-svg interpolation">plcIdentifier</span><span class="token template-string svg language-svg interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string svg language-svg">_1,</span><span class="token template-string svg language-svg interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string svg language-svg interpolation">plcIdentifier</span><span class="token template-string svg language-svg interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string svg language-svg">_2</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// on supprime les clips pour éviter de surcharger la mémoire</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// à l&#x27;issue de cette boucle, commandeLines contient:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// - les 3 commandes initiales permettant de charger et styliser les données</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// - x commandes permettant de générer, exporter et supprimer les clips pour chaque gare</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> mapshaper</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">runCommands</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">commandLines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\n&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// on balance toutes les commandes à mapshaper et on attend ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(78, 201, 176)">console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">Done in </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string interpolation keyword" style="color:rgb(86, 156, 214)">new</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation class-name" style="color:rgb(78, 201, 176)">Date</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:rgb(212, 212, 212)">-</span><span class="token template-string interpolation"> startTime</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation operator" style="color:rgb(212, 212, 212)">/</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation number" style="color:rgb(181, 206, 168)">1000</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)"> seconds</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Et voilà !</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">createPlacesFeatureCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">placesCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// cette fonction est relativement simple: on utilise le service existant &quot;createGeojsonFeatureFromPlace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// pour créer, pour chaque lieu, un objet &quot;point&quot; en geojson, qui permettra de constituer une carte de tous</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// les lieux voies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> placeFeatures </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  placesCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">forEach</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token parameter">place</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">place</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">isLocated</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        placeFeatures</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">push</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">createGeojsonFeatureFromPlace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">place</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token console class-name" style="color:rgb(78, 201, 176)">console</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">Erreur lors de la création de la feature correspondant au lieu </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">place</span><span class="token template-string interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token template-string interpolation property-access">slo</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string string" style="color:rgb(206, 145, 120)">: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">error</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword control-flow" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">featureCollection</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">placeFeatures</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// on lance la fonction principale</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">main</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et voilà ! En s&#x27;appuyant sur des services Bimo réutilisables et sur la librairie Open Source <a href="https://mapshaper.org" target="_blank" rel="noopener noreferrer">mapshaper</a>, on arrive, en moins d&#x27;une centaine de lignes de codes, à écrire un script assez puissant, qui nous donne des images semblables à celle-ci:</p>
<p><img decoding="async" loading="lazy" alt="Exemple d&amp;#39;image produite par le script" src="/assets/images/exemple-svg-gare-e9ad80ad4a51d6897a24fc27dcbd52e9.svg" width="800" height="300" class="img_ev3q"></p>
<p>On peut éventuellement le raffiner, ajuster le style des libellés des lieux, par exemple, ou la couleur des voies etc.</p>
<p>On peut également se poser la question de la performance: à l&#x27;heure actuelle, pour chaque gare, mapshaper doit faire un clip de l&#x27;énorme carte de la France entière, ce qui représente pas mal de travail. Avec cette version de base, il aurait fallu laisser tourner le script un peu moins de deux heures pour produire des images des quelques 5000 gares qui pouvaient nous intéresser.</p>
<p>Ce n&#x27;est pas rédhibitoire, mais quand même pas très pratique.</p>
<p>Dans un prochain article, on verra comment on a pu améliorer les performances pour descendre de 2h à moins de 10 minutes !</p>
</div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags :</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/examples/tags/hastus">hastus</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/examples/tags/cartographie">cartographie</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/examples/tags/geo">geo</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/examples/tags/mapshaper">mapshaper</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/examples/tags/lieux">lieux</a></li></ul></div></div></footer></article><div><hr></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des articles du blog"><a class="pagination-nav__link pagination-nav__link--prev" href="/examples/creation-du-service-get-bbox-for-place"><div class="pagination-nav__sublabel">Article plus récent</div><div class="pagination-nav__label">Créer un nouveau service Bimo</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#origine-du-besoin">Origine du besoin</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#exploration-des-solutions">Exploration des solutions</a><ul><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#processus-global">Processus global</a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#commandes-mapshaper">Commandes mapshaper</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#automatisation">Automatisation</a><ul><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#création-du-service-getbboxforplace">Création du service <code>getBboxForPlace</code></a></li><li><a class="table-of-contents__link toc-highlight" href="/examples/extraire-automatiquement-des-images-de-plans-de-voies-à-partir-de-la-cartographie-hastus#création-du-script-generate-station-svg">Création du script <code>generate-station-svg</code></a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/blog">Blog</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/examples">Exemples</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/intro">Documentation</a><span class="footer__link-separator">·</span><a href="https://github.com/bimodata/bimo" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Gaël Haméon</div></div></div></footer></div>
</body>
</html>